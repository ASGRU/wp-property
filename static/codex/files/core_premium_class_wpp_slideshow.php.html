<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/premium/class_wpp_slideshow.php - WP-Property</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="WP-Property"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.38.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/wpp.html">wpp</a></li>
            
                <li><a href="../classes/wpp.overview.html">wpp.overview</a></li>
            
                <li><a href="../classes/wpp.ui.agents.html">wpp.ui.agents</a></li>
            
                <li><a href="../classes/wpp.ui.feps.html">wpp.ui.feps</a></li>
            
                <li><a href="../classes/wpp.ui.settings.html">wpp.ui.settings</a></li>
            
                <li><a href="../classes/wpp.xmli.html">wpp.xmli</a></li>
            
                <li><a href="../classes/WPP_RETS.html">WPP_RETS</a></li>
            
                <li><a href="../classes/WPP_UI.html">WPP_UI</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core/premium/class_wpp_slideshow.php</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;?php
/**
 * Name: Slideshow and Carousel Gallery
 * Class: UsabilityDynamics\WPP\Slideshow
 * Version: 3.8.9
 * Minimum Core Version: 1.38.3
 * Minimum PHP Version: 5.5
 * Feature ID: 2
 * Description: Slideshow feature for WP-Property
 *
 */
namespace UsabilityDynamics\WPP {

  if( !class_exists( &#x27;UsabilityDynamics\WPP\Slideshow&#x27; ) ) {

    class Slideshow {

      /*
       * (custom) Capability to manage the current feature
       */
      static protected $capability = &quot;manage_wpp_slideshow&quot;;

      /**
       * Special functions that must be called prior to init
       *
       */
      function pre_init() {
        /* Add capability */
        add_filter( &#x27;wpp_capabilities&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &quot;add_capability&quot; ) );
      }

      /**
       * Primary feature function.  Ran an init level.
       *
       * @since 3.1
       */
      function init() {
        global $wp_properties;
        //** Load default settings if they do not exist */
        if( !$wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ] ) {
          $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;dimensions&#x27; ]     = &#x27;800x350&#x27;;
          $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ]    = 300;
          $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;property&#x27; ][ &#x27;dimensions&#x27; ] = &#x27;640x235&#x27;;
          $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;thumb_width&#x27; ]              = 300;
          update_option( &#x27;wpp_settings&#x27;, $wp_properties );
        }

        if( current_user_can( self::$capability ) ) {
          //* Add SLideshow tab to Property Settings tabs array */
          add_filter( &#x27;wpp_settings_nav&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;settings_nav&#x27; ) );
          //* Add Settings Page tab content*/
          add_action( &#x27;wpp_settings_content_slideshow&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;settings_page&#x27; ) );
          //* Display draggable selection pane for selecting images for slideshow.  */
          add_action( &#x27;add_meta_boxes&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;add_metabox&#x27; ) );
        }

        add_filter( &#x27;wpp_widget_property_gallery&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;widget_property_gallery&#x27; ), 10, 2 );

        //** Hook into property_overview shortcode so property_gallery can be called as a template */
        add_filter( &#x27;shortcode_property_overview_content&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;shortcode_property_overview_content&#x27; ), 10, 2 );
        add_filter( &#x27;shortcode_property_overview_allowed_args&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;shortcode_property_overview_allowed_args&#x27; ), 10, 2 );

        //* Save slideshow selection when saving property *
        add_action( &#x27;save_property&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;save_in_postmeta&#x27; ) );

        //* Add slideshow overview page under Properties nav menu */
        add_action( &quot;admin_menu&quot;, array( &quot;class_wpp_slideshow&quot;, &quot;admin_menu&quot; ) );

        //* Load Nivo slider on all front-end pages */
        add_action( &#x27;wp_enqueue_scripts&#x27;, create_function( &#x27;&#x27;, &quot;wp_enqueue_script(&#x27;wpp-jquery-nivo-slider&#x27;);&quot; ) );

        //* Render ajax response to control-panel image selection queries */
        add_action( &#x27;wp_ajax_wpp_slideshow_get_global_images&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;ajax_get_global_images&#x27; ) );

        add_action( &#x27;template_redirect&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;template_redirect&#x27; ) );
        add_action( &#x27;admin_init&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;admin_init&#x27; ) );

        //** Hook into pre-header functions of a single property page */
        add_action( &#x27;template_redirect_single_property&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;template_redirect_single_property&#x27; ) );

        //** Add two primary shortcodes */
        add_shortcode( &#x27;property_slideshow&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;shortcode_property_slideshow&#x27; ) );
        add_shortcode( &#x27;property_gallery&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;shortcode_property_gallery&#x27; ) );
        add_shortcode( &#x27;global_slideshow&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;shortcode_global_slideshow&#x27; ) );

      }

      /*
       * Adds Custom capability to the current premium feature
       */
      function add_capability( $capabilities ) {

        $capabilities[ self::$capability ] = __( &#x27;Manage Slideshow&#x27;, &#x27;wpp&#x27; );

        return $capabilities;
      }

      /*
       * Hook into property_overview shortcode defaults and add extra args so shortcode_atts() allows the passed arguments
       *
       * @author potanin@UD
       * @since 3.6.0
       */
      function shortcode_property_overview_allowed_args( $defaults = false, $atts = false ) {

        if( empty( $atts[ &#x27;template&#x27; ] ) || $atts[ &#x27;template&#x27; ] != &#x27;property_gallery&#x27; ) {
          return $defaults;
        }

        //** Just load some values, in practice they should be passed by user */
        $defaults[ &#x27;thumb_size&#x27; ] = &#x27;&#x27;;
        /** Only here for consistancy, thumbnail_size as usual for PO can be used */
        $defaults[ &#x27;large_size&#x27; ]                  = &#x27;large&#x27;;
        $defaults[ &#x27;image_size&#x27; ]                  = &#x27;medium&#x27;;
        $defaults[ &#x27;hide_if_no_images&#x27; ]           = &#x27;true&#x27;;
        $defaults[ &#x27;enforce_minimum_image_width&#x27; ] = &#x27;false&#x27;;
        $defaults[ &#x27;gallery_width&#x27; ]               = &#x27;&#x27;;
        $defaults[ &#x27;gallery_height&#x27; ]              = &#x27;&#x27;;
        $defaults[ &#x27;transition&#x27; ]                  = &#x27;fade&#x27;;

        return $defaults;

      }

      /*
       * Hooks into propert_overview shortcode and insert property_gallery carousel when &#x27;property_gallery&#x27; template is set.
       *
       * @author potanin@UD
       * @since 3.6.0
       */
      function shortcode_property_overview_content( $result, $wpp_query ) {
        global $wpp_query, $wp_query;

        if( $wpp_query[ &#x27;template&#x27; ] != &#x27;property_gallery&#x27; ) {
          return $result;
        }

        $wpp_query[ &#x27;disable_wrapper&#x27; ] = &#x27;true&#x27;;
        $wpp_query[ &#x27;pagination&#x27; ]      = &#x27;off&#x27;;
        $wpp_query[ &#x27;sorter_type&#x27; ]     = &#x27;none&#x27;;
        $wpp_query[ &#x27;hide_count&#x27; ]      = &#x27;true&#x27;;

        $s[ &#x27;thumb_size&#x27; ]                  = ( $wpp_query[ &#x27;thumb_size&#x27; ] ? $wpp_query[ &#x27;thumb_size&#x27; ] : $wpp_query[ &#x27;thumbnail_size&#x27; ] );
        $s[ &#x27;large_size&#x27; ]                  = $wpp_query[ &#x27;large_size&#x27; ];
        $s[ &#x27;image_size&#x27; ]                  = $wpp_query[ &#x27;image_size&#x27; ];
        $s[ &#x27;transition&#x27; ]                  = $wpp_query[ &#x27;galleria_transition&#x27; ];
        $s[ &#x27;width&#x27; ]                       = $wpp_query[ &#x27;gallery_width&#x27; ];
        $s[ &#x27;height&#x27; ]                      = $wpp_query[ &#x27;gallery_height&#x27; ];
        $s[ &#x27;enforce_minimum_image_width&#x27; ] = $wpp_query[ &#x27;enforce_minimum_image_width&#x27; ];

        if( !is_array( $wpp_query[ &#x27;properties&#x27; ][ &#x27;results&#x27; ] ) ) {
          return false;
        }

        //** Ensure galleria script is included */
        WPP_F::force_script_inclusion( &#x27;wp-property-galleria&#x27; );

        //** Get data for all images from results and load a mix of feature image ID and property data */
        foreach( $wpp_query[ &#x27;properties&#x27; ][ &#x27;results&#x27; ] as $count =&gt; $property_id ) {
          $property                             = WPP_F::get_property( $property_id, &#x27;load_gallery=false&amp;get_children=false&amp;return_object=true&#x27; );
          $gallery[ $count ][ &#x27;attachment_id&#x27; ] = $property-&gt;featured_image;
          $gallery[ $count ][ &#x27;post_title&#x27; ]    = $property-&gt;post_title;
          $gallery[ $count ][ &#x27;post_excerpt&#x27; ]  = $property-&gt;post_excerpt;
          $gallery[ $count ][ &#x27;link_url&#x27; ]      = $property-&gt;permalink;
        }

        $wp_query-&gt;query_vars[ &#x27;property&#x27; ][ &#x27;gallery&#x27; ] = $gallery;

        $gallery_result = class_wpp_slideshow::display_gallery( $s );

        if( !empty( $gallery_result ) ) {
          $result = $gallery_result;
        }

        return $result;
      }

      /**
       * Main back-end function.
       *
       * @since 3.5.0
       *
       */
      function admin_init() {

        //** Detect if FEPS Page */
        add_action( &#x27;wpp_widget_slideshow_bottom&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;widget_gallery&#x27; ) );

      }

      function widget_gallery( $args ) {

        $this_object = $args[ &#x27;this_object&#x27; ];
        $instance    = $args[ &#x27;instance&#x27; ];

        $galleria_gallery            = $instance[ &#x27;galleria_gallery&#x27; ];
        $galleria_transition         = $instance[ &#x27;galleria_transition&#x27; ];
        $imageCrop                   = $instance[ &#x27;imageCrop&#x27; ];
        $carousel_thumb_size         = $instance[ &#x27;carousel_thumb_size&#x27; ];
        $enforce_minimum_image_width = $instance[ &#x27;enforce_minimum_image_width&#x27; ];

        $this_id = &#x27;wpp_gallery_galleria_settings_&#x27; . rand( 1000, 9999 );
        ?&gt;
        &lt;div class=&quot;&lt;?php echo $this_id; ?&gt; wpp_gallery_galleria_settings&quot;&gt;

    &lt;style type=&quot;text/css&quot;&gt;
      .widget .widget-inside .&lt;?php echo $this_id; ?&gt;  p.wpp_gallery_galleria_options {
      &lt;?php if($galleria_gallery != &#x27;on&#x27;)  { ?&gt; display: none;
      &lt;?php } ?&gt; background-color: #EAEAEA;
        margin: -6px -6px 5px -6px;
        padding: 9px 9px 6px;
      }
    &lt;/style&gt;

    &lt;script type=&quot;text/javascript&quot;&gt;
      jQuery( document ).ready( function() {

        toggle_widget_galleria( &quot;.&lt;?php echo $this_id; ?&gt; .wpp_toggle_galleria_options&quot; );

        jQuery( &quot;.&lt;?php echo $this_id; ?&gt; .wpp_toggle_galleria_options&quot; ).live( &quot;change&quot;, function() {
          toggle_widget_galleria( this );
        } );

        function toggle_widget_galleria( checkbox ) {

          var widget_parent = jQuery( checkbox ).closest( &quot;.widget-content&quot; );

          if( jQuery( checkbox ).is( &quot;:checked&quot; ) ) {
            jQuery( &quot;.wpp_gallery_galleria_options&quot;, widget_parent ).show();
            jQuery( &quot;.wpp_gallery_big_image_type&quot;, widget_parent ).hide();
            jQuery( &quot;.wpp_gallery_show_description&quot;, widget_parent ).hide();
          } else {
            jQuery( &quot;.wpp_gallery_galleria_options&quot;, widget_parent ).hide();
            jQuery( &quot;.wpp_gallery_big_image_type&quot;, widget_parent ).show();
            jQuery( &quot;.wpp_gallery_show_description&quot;, widget_parent ).show();
          }
        }

      } );
    &lt;/script&gt;

    &lt;p style=&quot;margin-bottom: 20px;&quot;&gt;
      &lt;input name=&quot;&lt;?php echo $this_object-&gt;get_field_name( &#x27;galleria_gallery&#x27; ); ?&gt;&quot; id=&quot;&lt;?php echo $this_object-&gt;get_field_id( &#x27;galleria_gallery&#x27; ) ?&gt;&quot; type=&quot;checkbox&quot; &lt;?php checked( &#x27;on&#x27;, $galleria_gallery ); ?&gt; value=&quot;on&quot; class=&quot;wpp_toggle_galleria_options&quot;/&gt;
      &lt;label for=&quot;&lt;?php echo $this_object-&gt;get_field_id( &#x27;galleria_gallery&#x27; ) ?&gt;&quot;&gt;&lt;?php _e( &#x27;Display as carousel gallery.&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/label&gt;
    &lt;/p&gt;

    &lt;p class=&quot;wpp_gallery_galleria_options&quot;&gt;
      &lt;label for=&quot;&lt;?php echo $this_object-&gt;get_field_id( &#x27;galleria_transition&#x27; ) ?&gt;&quot;&gt;&lt;?php _e( &#x27;Gallery transition type:&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/label&gt;
      &lt;select name=&quot;&lt;?php echo $this_object-&gt;get_field_name( &#x27;galleria_transition&#x27; ); ?&gt;&quot; id=&quot;&lt;?php echo $this_object-&gt;get_field_id( &#x27;galleria_transition&#x27; ) ?&gt;&quot;&gt;
        &lt;option &lt;?php selected( $galleria_transition, &#x27;fade&#x27; ); ?&gt; value=&quot;fade&quot;&gt;&lt;?php _e( &#x27;Crossfade betweens images&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/option&gt;
        &lt;option &lt;?php selected( $galleria_transition, &#x27;flash&#x27; ); ?&gt; value=&quot;flash&quot;&gt;&lt;?php _e( &#x27;Fade into background color&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/option&gt;
        &lt;option &lt;?php selected( $galleria_transition, &#x27;pulse&#x27; ); ?&gt; value=&quot;pulse&quot;&gt;&lt;?php _e( &#x27;Pulse&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/option&gt;
        &lt;option &lt;?php selected( $galleria_transition, &#x27;slide&#x27; ); ?&gt; value=&quot;slide&quot;&gt;&lt;?php _e( &#x27;Slide&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/option&gt;
        &lt;option &lt;?php selected( $galleria_transition, &#x27;fadeslide&#x27; ); ?&gt; value=&quot;fadeslide&quot;&gt;&lt;?php _e( &#x27;Fadeslide&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/option&gt;
      &lt;/select&gt;
    &lt;/p&gt;

    &lt;p class=&quot;wpp_gallery_galleria_options&quot;&gt;
      &lt;input name=&quot;&lt;?php echo $this_object-&gt;get_field_name( &#x27;imageCrop&#x27; ); ?&gt;&quot; id=&quot;&lt;?php echo $this_object-&gt;get_field_id( &#x27;imageCrop&#x27; ) ?&gt;&quot; type=&quot;checkbox&quot; &lt;?php checked( &#x27;true&#x27;, $imageCrop ); ?&gt; value=&quot;true&quot;/&gt;
      &lt;label for=&quot;&lt;?php echo $this_object-&gt;get_field_id( &#x27;imageCrop&#x27; ) ?&gt;&quot;&gt;&lt;?php _e( &#x27;Crop images.&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/label&gt;
    &lt;/p&gt;

    &lt;p class=&quot;wpp_gallery_galleria_options&quot;&gt;
      &lt;input name=&quot;&lt;?php echo $this_object-&gt;get_field_name( &#x27;enforce_minimum_image_width&#x27; ); ?&gt;&quot; id=&quot;&lt;?php echo $this_object-&gt;get_field_id( &#x27;enforce_minimum_image_width&#x27; ) ?&gt;&quot; type=&quot;checkbox&quot; &lt;?php checked( &#x27;true&#x27;, $enforce_minimum_image_width ); ?&gt; value=&quot;true&quot;/&gt;
      &lt;label for=&quot;&lt;?php echo $this_object-&gt;get_field_id( &#x27;enforce_minimum_image_width&#x27; ) ?&gt;&quot;&gt;&lt;?php _e( &#x27;Enforce minimum image width.&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/label&gt;
    &lt;/p&gt;

    &lt;p class=&quot;wpp_gallery_galleria_options&quot;&gt;
      &lt;label for=&quot;&lt;?php echo $this_object-&gt;get_field_id( &#x27;carousel_thumb_size&#x27; ); ?&gt;&quot;&gt;&lt;?php _e( &#x27;Carousel Thumbnail Size:&#x27; ); ?&gt;&lt;/label&gt;
      &lt;?php WPP_F::image_sizes_dropdown( &quot;name=&quot; . $this_object-&gt;get_field_name( &#x27;carousel_thumb_size&#x27; ) . &quot;&amp;selected=&quot; . $carousel_thumb_size ); ?&gt;
    &lt;/p&gt;

    &lt;p class=&quot;wpp_gallery_galleria_options&quot; style=&quot;height: 5px;&quot;&gt;&lt;/p&gt;

    &lt;/div&gt;
      &lt;?php

      }

      function __construct() {
        add_action( &#x27;wpp_init&#x27;, array( &#x27;UsabilityDynamics\WPP\Slideshow&#x27;, &#x27;init&#x27; ) );

        add_action( &#x27;wpp_pre_init&#x27;, array( &#x27;UsabilityDynamics\WPP\Slideshow&#x27;, &#x27;pre_init&#x27; ) );

      }

      function get( $key, $default ) {
      }

      function set( $key, $value ) {
      }

      /**
       * Take over property widget if it is a galleria widget.
       *
       * @since 3.5.0
       *
       */
      function widget_property_gallery( $html, $data ) {

        $post     = $data[ &#x27;post&#x27; ];
        $args     = $data[ &#x27;args&#x27; ];
        $instance = $data[ &#x27;instance&#x27; ];

        if( $instance[ &#x27;galleria_gallery&#x27; ] != &#x27;on&#x27; ) {
          return $html;
        }

        $s[ &#x27;large_size&#x27; ]                  = $instance[ &#x27;big_image_type&#x27; ];
        $s[ &#x27;image_size&#x27; ]                  = $instance[ &#x27;image_type&#x27; ];
        $s[ &#x27;thumb_size&#x27; ]                  = $instance[ &#x27;carousel_thumb_size&#x27; ];
        $s[ &#x27;transition&#x27; ]                  = $instance[ &#x27;galleria_transition&#x27; ];
        $s[ &#x27;enforce_minimum_image_width&#x27; ] = $instance[ &#x27;enforce_minimum_image_width&#x27; ];

        //** Ensure galleria script is included */
        WPP_F::force_script_inclusion( &#x27;wp-property-galleria&#x27; );

        $html[ &#x27;images&#x27; ] = class_wpp_slideshow::display_gallery( $s );

        return $html;

      }

      /**
       * Main front-end function.
       *
       * @since 3.5.0
       *
       */
      function template_redirect() {

        //** Detect if FEPS Page */
        if( WPP_F::detect_shortcode( &#x27;property_gallery&#x27; ) ) {
          self::enqueue_scripts();
        }

      }

      /**
       * Load any front-end scripts
       *
       * @since 3.5.0
       *
       */
      function enqueue_scripts() {
        wp_enqueue_script( &#x27;wp-property-galleria&#x27; );
      }

      /**
       * Perform any pre-header functions of single property pages.
       *
       * If ths current property has a slideshow, we pas it into &#x27;wpp_property_page_vars&#x27; filter,
       * which then passed it into $wp_query-&gt;query_vars, which is then extracted on the single propety pages.
       *
       * @since 3.3.5
       *
       */
      function template_redirect_single_property() {

        //** Does not check if the slideshow is in header -&gt; just that the property has slideshow images */
        if( class_wpp_slideshow::display_slideshow( array( &#x27;type&#x27; =&gt; &#x27;single&#x27; ) ) ) {
          add_filter( &#x27;wpp_property_page_vars&#x27;, create_function( &#x27;$current&#x27;, &#x27; $current[slideshow] = true; return $current; &#x27; ), 20 );
        }

      }

      /**
       * Renders ajax response to query for image selection
       *
       * Used on global slideshow admin page.
       *
       * @since 3.1
       *
       */
      function ajax_get_global_images() {
        global $wp_properties;

        if( !wp_verify_nonce( $_REQUEST[ &#x27;_wpnonce&#x27; ], &#x27;wpp_get_global_images&#x27; ) ) {
          die();
        }

        //** Get image size (set globally) */
        $image_type = $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;image_size&#x27; ];

        $good_images = class_wpp_slideshow::get_global_images( $_REQUEST[ &#x27;selection&#x27; ] );

        foreach( (array) $good_images as $image_obj ) {
          $image = $image_obj[ &#x27;image_id&#x27; ];
          class_wpp_slideshow::draggable_image_block( $image, $image_type, true, $image_obj );
        }

        die();
      }

      /**
       * Load images based on size and location
       *
       * Used on global slideshow admin page.
       *
       * @since 3.1
       *
       */
      function get_global_images( $type = false ) {
        global $wpdb, $wp_properties;

        $image_type  = $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;image_size&#x27; ];
        $image_sizes = WPP_F::image_sizes( $image_type );

        if( !$type ) {
          $type = &#x27;featured_property_images&#x27;;
        }

        switch( $type ) {

          case &#x27;featured_property_images&#x27;:
            $all_images = $wpdb-&gt;get_results( &quot;
      SELECT pm.post_id as image_id, pm.meta_value as dimensions, p.post_title as image_title, p2.post_title as property_title, p2.post_type as post_type, m2.meta_value featured_id, p2.ID as property_id
      FROM {$wpdb-&gt;postmeta} pm
      LEFT JOIN {$wpdb-&gt;posts} p on pm.post_id = p.ID
      LEFT JOIN {$wpdb-&gt;posts} p2 on p.post_parent = p2.ID
      LEFT JOIN {$wpdb-&gt;postmeta} m2 on pm.post_id = m2.meta_value
      WHERE pm.meta_key = &#x27;_wp_attachment_metadata&#x27;
      AND p2.post_type = &#x27;property&#x27;
      AND m2.meta_value = pm.post_id
      AND m2.meta_key = &#x27;_thumbnail_id&#x27;
      AND p.post_mime_type IN (&#x27;image/jpeg&#x27;,&#x27;image/jpg&#x27;,&#x27;image/gif&#x27;,&#x27;image/png&#x27;,&#x27;image/bmp&#x27;)&quot; );
            break;

          case &#x27;all_property_images&#x27;:
            $all_images = $wpdb-&gt;get_results( &quot;
      SELECT pm.post_id as image_id, pm.meta_value as dimensions, p.post_title as image_title, p2.post_title as property_title, p2.post_type as post_type, p2.ID as property_id
      FROM {$wpdb-&gt;postmeta} pm
      LEFT JOIN {$wpdb-&gt;posts} p on pm.post_id = p.ID
      LEFT JOIN {$wpdb-&gt;posts} p2 on p.post_parent = p2.ID
      WHERE pm.meta_key = &#x27;_wp_attachment_metadata&#x27;
      AND p2.post_type = &#x27;property&#x27;
      AND p.post_mime_type IN (&#x27;image/jpeg&#x27;,&#x27;image/jpg&#x27;,&#x27;image/gif&#x27;,&#x27;image/png&#x27;,&#x27;image/bmp&#x27;)&quot; );
            break;

          case &#x27;all_images&#x27;:
            $all_images = $wpdb-&gt;get_results( &quot;
      SELECT pm.post_id as image_id, pm.meta_value as dimensions, p.post_title as image_title, p2.post_title as property_title, p2.post_type as post_type, p2.ID as property_id
      FROM {$wpdb-&gt;postmeta} pm
      LEFT JOIN {$wpdb-&gt;posts} p on pm.post_id = p.ID
      LEFT JOIN {$wpdb-&gt;posts} p2 on p.post_parent = p2.ID
      WHERE pm.meta_key = &#x27;_wp_attachment_metadata&#x27;
      AND p.post_mime_type IN (&#x27;image/jpeg&#x27;,&#x27;image/jpg&#x27;,&#x27;image/gif&#x27;,&#x27;image/png&#x27;,&#x27;image/bmp&#x27;)&quot; );
            break;

        }

        if( is_array( $all_images ) ) {
          foreach( $all_images as $count =&gt; $image ) {
            $sizes = unserialize( $image-&gt;dimensions );

            if( $sizes[ &#x27;width&#x27; ] &gt;= $image_sizes[ &#x27;width&#x27; ] ) {
              $good_images[ $count ][ &#x27;image_id&#x27; ]       = $image-&gt;image_id;
              $good_images[ $count ][ &#x27;iamge_title&#x27; ]    = $image-&gt;image_title;
              $good_images[ $count ][ &#x27;property_title&#x27; ] = $image-&gt;property_title;
              $good_images[ $count ][ &#x27;post_type&#x27; ]      = $image-&gt;post_type;
            }

          }
        }

        return $good_images;
      }

      /**
       * Add draggable image selection pane to single property page
       *
       * Used on global slideshow admin page.
       *
       * @since 3.1
       *
       */
      function add_metabox() {
        add_meta_box( &#x27;wp_property_slideshow&#x27;, __( &#x27;Slideshow Options&#x27;, &#x27;wpp&#x27; ), array( &#x27;class_wpp_slideshow&#x27;, &#x27;slideshow_options&#x27; ), &#x27;property&#x27;, &#x27;normal&#x27; );
      }

      /**
       * Draws the draggable image selection pane
       *
       *
       * @todo This function needs to be cleaned up.
       * @since 3.1
       *
       */
      function slideshow_options() {
        global $wpdb, $wp_properties, $post, $post_id;

        $thumb_type = ( !empty( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] )
        &amp;&amp; !is_numeric( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] )
        &amp;&amp; $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] != &#x27;-&#x27; ? $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] : &#x27;thumbnail&#x27; );

        $thumb_info = WPP_F::image_sizes( $thumb_type );

        $thumb_width    = $thumb_info[ &#x27;width&#x27; ];
        $image_type     = $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;property&#x27; ][ &#x27;image_size&#x27; ];
        $prop_slideshow = WPP_F::image_sizes( $image_type );

        if( empty( $prop_slideshow[ &#x27;width&#x27; ] ) )
          $prop_slideshow[ &#x27;width&#x27; ] = &#x27;640&#x27;;

        if( empty( $prop_slideshow[ &#x27;height&#x27; ] ) )
          $prop_slideshow[ &#x27;height&#x27; ] = &#x27;235&#x27;;

        /* Fix values if for some reason nothing is set */
        if( empty( $thumb_width ) )
          $thumb_width = &#x27;250&#x27;;

        //** Get current images */
        $current = get_post_meta( $post-&gt;ID, &#x27;slideshow_images&#x27;, 1 );
        $current = is_array( $current ) ? array_unique( $current ) : array();

        $gallery_images = get_post_meta( $post-&gt;ID, &#x27;gallery_images&#x27;, 1 );
        $gallery_images = is_array( $gallery_images ) ? array_unique( $gallery_images ) : array();
        $gallery_images = array_diff( $gallery_images, $current );

        if( empty( $gallery_images ) ) {

          $args        = array(
            &#x27;post_type&#x27;   =&gt; &#x27;attachment&#x27;,
            &#x27;numberposts&#x27; =&gt; -1,
            &#x27;post_status&#x27; =&gt; null,
            &#x27;post_parent&#x27; =&gt; $post-&gt;ID
          );
          $attachments = get_posts( $args );

          foreach( (array) $attachments as $attachment ) {
            if( $attachment-&gt;post_mime_type == &#x27;image/jpeg&#x27; || $attachment-&gt;post_mime_type == &#x27;image/png&#x27; || $attachment-&gt;post_mime_type == &#x27;image/gif&#x27; ) {
              $all_images[ ] = $attachment;
            }
          }

        } else {

          $exclude = array();

          foreach( (array) $gallery_images as $gallery_image_id ) {
            $exclude[ ] = $gallery_image_id;
            $attachment = get_post( $gallery_image_id );
            if( $attachment-&gt;post_mime_type == &#x27;image/jpeg&#x27; || $attachment-&gt;post_mime_type == &#x27;image/png&#x27; || $attachment-&gt;post_mime_type == &#x27;image/gif&#x27; ) {
              $all_images[ ] = $attachment;
            }
          }

          $args        = array(
            &#x27;post_type&#x27;   =&gt; &#x27;attachment&#x27;,
            &#x27;numberposts&#x27; =&gt; -1,
            &#x27;post_status&#x27; =&gt; null,
            &#x27;post_parent&#x27; =&gt; $post-&gt;ID,
            &#x27;exclude&#x27;     =&gt; array_merge( $exclude, $current )
          );
          $rest_images = get_posts( $args );

          foreach( (array) $rest_images as $attachment ) {
            if( $attachment-&gt;post_mime_type == &#x27;image/jpeg&#x27; || $attachment-&gt;post_mime_type == &#x27;image/png&#x27; || $attachment-&gt;post_mime_type == &#x27;image/gif&#x27; ) {
              $all_images[ ] = $attachment;
            }
          }

        }

        ?&gt;

        &lt;style type=&quot;text/css&quot;&gt;

  #wp_property_slideshow.postbox {
    background: transparent;
    border: 0;
  }

  #wp_property_slideshow.postbox .handlediv {
    display: none;
  }

  #wp_property_slideshow.postbox h3.hndle {
    display: none;
  }

  .wpp_slideshow_global_selected {
    clear: right;
    display: block;
    float: right;
    position: relative;
    margin-right: 20px;
    width: &lt;?php echo ($thumb_info[&#x27;width&#x27;] + 20); ?&gt;px;
  }

  .wpp_slideshow_global_all {
    clear: left;
    float: left;
    margin-right: -&lt;?php echo ($thumb_info[&#x27;width&#x27;] + 100); ?&gt;px;
    width: 100%;
  }

  .wpp_slideshow_global_all_inner {
    position: relative;
    margin-right: &lt;?php echo ($thumb_info[&#x27;width&#x27;] + 60); ?&gt;px;

  }

  .wpp_slideshow_global_all_inner .wpp_slideshow_global_all_inner_menu {
    position: absolute;
    right: 11px;
    text-align: right;
    top: 0;
    width: 440px;
  }

  .wpp_slideshow_global_all_inner #sortable1 {
    overflow: auto;
  }

  .wpp_slideshow_image_block {
    margin: 5px;
    position: relative;
    max-width: 33%;
    max-height: auto;
  }

  #sortable1 .wpp_slideshow_image_block {
    float: left;
  }

  #wpp_slideshow_show_help,
  #wpp_slideshow_auto_add {
    cursor: pointer;
  }

  .wpp_slideshow_postbox_description {
    display: none;
    background-color: #FFFFE0;
    margin: 5px 0 15px;
    border-color: #E6DB55;
    -moz-border-radius: 3px 3px 3px 3px;
    border-style: solid;
    border-width: 1px;
    padding: 0 0.6em;

  }

  #sortable1, #sortable2 {
    background: none repeat scroll 0 0 #EDEDEF;
    border: 7px solid #BABABA;
    list-style-type: none;
    margin: 0 10px 0 0;
    min-height: 300px;
    padding: 10px;
  }

  .image_block .title {
    font-size: 1.4em;
  }

  #sortable1 li, #sortable2 li {
    font-size: 1.2em;

    padding: 0 0 6px;
    text-align: center;
    width: &lt;?php echo $thumb_info[&#x27;thumb_width&#x27;]; ?&gt;px;
  }

  #sortable1 li img, #sortable2 li img {
    border: 1px solid #888888;
    cursor: move;
  }

  #sortable1 {
    border: 7px solid #DADADA;
    min-height: 300px;
    min-width: &lt;?php echo $thumb_info[&#x27;width&#x27;] + 10; ?&gt;px;
  }

  #sortable2 {
    background: none repeat scroll 0 0 #F8FFC6;
    border: 7px solid #D5CD9C;
    min-height: 300px;
    min-width: &lt;?php echo $thumb_info[&#x27;width&#x27;] + 10; ?&gt;px;
  }

  .wpp_selected_images_title, .wpp_all_images_title {
    display: table;
    padding: 10px;
    font-weight: bold;
  }

  .wpp_slideshow_image_block {
    float: left;
    padding: 0;
    margin: 0px;
    position: relative;
  }

  .wpp_slideshow_image_block img.wpp_image_element {
    margin: 0em;
    max-width: 100%;
    max-height: auto;
  }

  .wpp_image_missing .wpp_image_element {
    display: block;
    position: relative;
    background: #E7E7E7;
  }

  .wpp_selected_images_title {
    background: #D5CD9C;
  }

  .wpp_all_images_title {
    background: #DADADA;

  }

  .wpp_slideshow_image_stats.image_does_not_exist {
    background: none repeat scroll 0 0 #FFCFCF;
    border: 1px solid #BB8C8C;
    color: #543636;
    left: 2%;
    position: absolute;
    top: 4px;
    width: 93%;
  }

  .wpp_slideshow_image_stats.image_exists {
    background: none repeat scroll 0 0 #BDEABC;
    border: 1px solid #57B873;
    color: #46704F;
  }



  &lt;/style&gt;&lt;!-- styles --&gt;

        &lt;script type=&quot;text/javascript&quot;&gt;
  jQuery( function() {

    jQuery( &quot;#wpp_slideshow_show_help&quot; ).click( function() {
      jQuery( &quot;.wpp_slideshow_postbox_description&quot; ).toggle();
    } );

    jQuery( &quot;#wpp_slideshow_auto_add&quot; ).click( function() {
      wpp_slideshow_add_all();
    } );

    jQuery( &quot;#sortable1, #sortable2&quot; ).sortable( {
      connectWith: &#x27;.connectedSortable&#x27;,
      update: function() {
        wpp_slideshow_update_order();
      }
    } ).disableSelection();

    jQuery( &quot;.image_block a&quot; ).click( function( e ) {
      e.preventDefault();
    } );

    wpp_slideshow_update_order();

  } );

  function wpp_slideshow_add_all() {

    jQuery( &quot;#sortable1 .wpp_slideshow_image_block&quot; ).each( function() {
      if( jQuery( this ).attr( &quot;can_use&quot; ) == &#x27;true&#x27; ) {
        jQuery( this ).appendTo( &quot;#sortable2&quot; );
      }
    } );

    jQuery( &quot;#sortable2 .wpp_slideshow_image_block&quot; ).each( function() {
      if( jQuery( this ).attr( &quot;can_use&quot; ) == &#x27;false&#x27; ) {
        jQuery( this ).appendTo( &quot;#sortable1&quot; );
      }
    } );

    wpp_slideshow_update_order();

  }

  function wpp_slideshow_update_order() {
    var order = jQuery( &#x27;#sortable2&#x27; ).sortable( &#x27;serialize&#x27;, {key: &#x27;item&#x27;} );
    if( order != &#x27;&#x27; ) {
      jQuery( &quot;#slideshow_image_array&quot; ).val( order );
    } else {
      jQuery( &quot;#slideshow_image_array&quot; ).val( &#x27;item=&#x27; );
    }

    var gallery_order = jQuery( &#x27;#sortable1&#x27; ).sortable( &#x27;serialize&#x27;, {key: &#x27;item&#x27;} );
    if( gallery_order != &#x27;&#x27; ) {
      jQuery( &quot;#gallery_image_array&quot; ).val( gallery_order );
    } else {
      jQuery( &quot;#gallery_image_array&quot; ).val( &#x27;item=&#x27; );
    }
  }

  &lt;/script&gt;&lt;!-- /scripts --&gt;

        &lt;div class=&quot;wpp_slideshow_postbox_description &quot;&gt;
  &lt;p&gt;Please ensure the images are large enough for the slideshow. The image sizes for the slideshow are set on &lt;a href=&quot;&lt;?php echo admin_url( &quot;edit.php?post_type=property&amp;page=property_settings#tab_slideshow&quot; ); ?&gt;&quot;&gt;Slideshow Settings Page&lt;/a&gt;.  If an image is too small, it will not be included in the actual slideshow.  To avoid pixelation, WP-Property will never stretch out your images. &lt;/p&gt;
  &lt;p&gt;Current size: &lt;b&gt;&lt;?php echo $prop_slideshow[ &#x27;width&#x27; ]; ?&gt;px&lt;/b&gt; by &lt;b&gt;&lt;?php echo $prop_slideshow[ &#x27;height&#x27; ]; ?&gt;
      px&lt;/b&gt;, using &lt;b&gt;&lt;?php echo $image_type; ?&gt;&lt;/b&gt;.&lt;/p&gt;
          &lt;?php if( class_exists( &#x27;RegenerateThumbnails&#x27; ) ): ?&gt;
            &lt;p&gt;If you create a new image size, be sure to &lt;a href=&quot;&lt;?php echo admin_url( &quot;tools.php?page=regenerate-thumbnails&quot; ); ?&gt;&quot;&gt;regenerate your thumbnails&lt;/a&gt;. &lt;/p&gt;
          &lt;?php else: ?&gt;
            &lt;p&gt;If you create a new image size, be sure to regenerate your thumbnails using the &lt;a href=&quot;http://wordpress.org/extend/plugins/regenerate-thumbnails/&quot;&gt;Regenerate Thumbnails&lt;/a&gt;.&lt;/p&gt;
          &lt;?php endif; ?&gt;
  &lt;/div&gt;

        &lt;input type=&quot;hidden&quot; name=&quot;property_slideshow_image_array&quot; id=&quot;slideshow_image_array&quot; value=&quot;&quot;/&gt;
        &lt;input type=&quot;hidden&quot; name=&quot;property_gallery_image_array&quot; id=&quot;gallery_image_array&quot; value=&quot;&quot;/&gt;

        &lt;div class=&quot;wpp_slideshow_images&quot;&gt;
  &lt;div class=&quot;wpp_slideshow_global_selected image_block&quot;&gt;
   &lt;span class=&quot;wpp_selected_images_title&quot;&gt; &lt;?php _e( &#x27;Slideshow Images:&#x27;, &#x27;wpp&#x27; ) ?&gt;&lt;/span&gt;
    &lt;ul id=&quot;sortable2&quot; class=&quot;connectedSortable clearfix&quot;&gt;
   &lt;?php
   if( is_array( $current ) ):
     foreach( $current as $curr_id ):
       if( count( $curr_id ) &gt; 0 ) {

         foreach( (array) $curr_id as $cur_id ) {
           if( $cur_id ) {
             class_wpp_slideshow::draggable_image_block( $cur_id, $image_type );
           }
         }
       }
     endforeach;
   endif; ?&gt;
   &lt;/ul&gt;

  &lt;/div&gt;


  &lt;div class=&quot;wpp_slideshow_global_all image_block&quot;&gt;
  &lt;div class=&quot;wpp_slideshow_global_all_inner&quot;&gt;
    &lt;span class=&quot;wpp_all_images_title&quot;&gt;&lt;?php _e( &#x27;All Images:&#x27;, &#x27;wpp&#x27; ) ?&gt;&lt;/span&gt;

    &lt;div class=&quot;wpp_slideshow_global_all_inner_menu&quot;&gt;
    &lt;span class=&quot;description&quot; id=&quot;wpp_slideshow_show_help&quot;&gt;Help&lt;/span&gt; |
    &lt;span class=&quot;description&quot; id=&quot;wpp_slideshow_auto_add&quot;&gt;Auto Fix&lt;/span&gt;
  &lt;/div&gt;

   &lt;ul id=&quot;sortable1&quot; class=&quot;connectedSortable clearfix&quot;&gt;
   &lt;?php
   foreach( (array) $all_images as $image ) {
     $image_meta = wp_get_attachment_metadata( $image-&gt;ID );
     $image_info = wp_get_attachment_image_src( $image-&gt;ID, $image_type );
     $image_url  = $image_info[ &#x27;width&#x27; ];

     $cur = $current[ 0 ];
     /* skip if current */
     if( is_array( $cur ) )
       if( in_array( $image-&gt;ID, $cur ) )
         continue;

     class_wpp_slideshow::draggable_image_block( $image-&gt;ID, $image_type );
   }
   ?&gt;
   &lt;/ul&gt;
  &lt;/div&gt;
  &lt;/div&gt;

  &lt;/div&gt;


        &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;

      &lt;?php
      }

      /**
       * Displays an image block for draggable selection lists.
       *
       * Used on global slideshow admin page.
       *
       * @since 3.1
       *
       */
      function draggable_image_block( $image_id, $image_type, $echo = true, $image_obj = false ) {
        global $wp_properties;

        $thumb_type = ( !empty( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] )
        &amp;&amp; !is_numeric( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] )
        &amp;&amp; $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] != &#x27;-&#x27; ? $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] : &#x27;thumbnail&#x27; );

        $image = wpp_get_image_link( $image_id, $thumb_type, array( &#x27;return&#x27; =&gt; &#x27;array&#x27; ) );

        if( empty( $image[ &#x27;link&#x27; ] ) ) {
          return;
        }

        $required_dimensions = WPP_F::image_sizes( $image_type );

        //** Get original image sizes */
        $image_meta                     = wp_get_attachment_metadata( $image_id );
        $primary_image_meta[ &#x27;width&#x27; ]  = $image_meta[ &#x27;width&#x27; ];
        $primary_image_meta[ &#x27;height&#x27; ] = $image_meta[ &#x27;height&#x27; ];

        ob_start();

        ?&gt;
        &lt;li can_use=&quot;&lt;?php echo $primary_image_meta[ &#x27;width&#x27; ] &lt; $required_dimensions[ &#x27;width&#x27; ] ? &#x27;false&#x27; : &#x27;true&#x27; ?&gt;&quot; id=&quot;image_&lt;?php echo $image_id; ?&gt;&quot; class=&quot;wpp_slideshow_image_block&quot;&gt;
        &lt;img class=&quot;wpp_image_element&quot; src=&quot;&lt;?php echo $image[ &#x27;link&#x27; ]; ?&gt;&quot; style=&quot;&lt;?php echo( $image[ &#x27;width&#x27; ] ? &quot;width: {$image[&#x27;width&#x27;]}px;&quot; : &#x27;&#x27; ); ?&gt;&quot;/&gt;

          &lt;?php if( $primary_image_meta[ &#x27;width&#x27; ] &lt; $required_dimensions[ &#x27;width&#x27; ] ) { ?&gt;
            &lt;div class=&quot;wpp_slideshow_image_stats image_does_not_exist&quot;&gt;
        &lt;?php _e( &#x27;Image is too small.&#x27;, &#x27;wpp&#x27; ); ?&gt;
        &lt;/div&gt;
          &lt;?php } ?&gt;

      &lt;/li&gt;
        &lt;?php
        $return = ob_get_contents();
        ob_end_clean();

        if( !$echo ) {
          return $return;
        }
        echo $return;
      }

      /**
       * Called in property_save to commit slideshow image selection to database.
       *
       *
       * @since 3.1
       *
       */
      function save_in_postmeta( $post_id ) {
        if( !empty( $_POST[ &#x27;property_slideshow_image_array&#x27; ] ) ) {
          /* fix array  */
          $string_array = $_POST[ &#x27;property_slideshow_image_array&#x27; ];
          $string_array = str_replace( &#x27;item=&#x27;, &#x27;&#x27;, $string_array );
          $image_array  = explode( &#x27;&amp;&#x27;, $string_array );
          update_post_meta( $post_id, &#x27;slideshow_images&#x27;, $image_array );
        } else {
          delete_post_meta( $post_id, &#x27;slideshow_images&#x27; );
        }
        if( !empty( $_POST[ &#x27;property_gallery_image_array&#x27; ] ) ) {
          /* fix array  */
          $string_array = $_POST[ &#x27;property_gallery_image_array&#x27; ];
          $string_array = str_replace( &#x27;item=&#x27;, &#x27;&#x27;, $string_array );
          $image_array  = explode( &#x27;&amp;&#x27;, $string_array );
          update_post_meta( $post_id, &#x27;gallery_images&#x27;, $image_array );
        } else {
          delete_post_meta( $post_id, &#x27;gallery_images&#x27; );
        }
      }

      /**
       * Adds slideshow manu to settings page navigation
       *
       * Copyright 2010 Andy Potanin &lt;andy.potanin@twincitiestech.com&gt;
       */
      function settings_nav( $tabs ) {
        $tabs[ &#x27;slideshow&#x27; ] = array(
          &#x27;slug&#x27;  =&gt; &#x27;slideshow&#x27;,
          &#x27;title&#x27; =&gt; __( &#x27;Slideshow&#x27;, &#x27;wpp&#x27; )
        );

        return $tabs;
      }

      /**
       * Adds scripts and styles to slideshow pages.
       *
       * @since 3.1
       */
      function admin_menu() {

        $slideshow_page = add_submenu_page( &#x27;edit.php?post_type=property&#x27;, __( &#x27;Slideshow&#x27;, &#x27;wpp&#x27; ), __( &#x27;Slideshow&#x27;, &#x27;wpp&#x27; ), self::$capability, &#x27;slideshow&#x27;, array( &#x27;class_wpp_slideshow&#x27;, &#x27;page_global_slideshow&#x27; ) );

        /* Insert Scripts */
        add_action( &#x27;admin_print_scripts-&#x27; . $slideshow_page, create_function( &#x27;&#x27;, &quot;wp_enqueue_script(&#x27;jquery-ui-resizable&#x27;); wp_enqueue_script(&#x27;wpp-jquery-fancybox&#x27;);wp_enqueue_script( &#x27;jquery-ui-sortable&#x27;); &quot; ) );
        /* Insert Styles */
        add_action( &#x27;admin_print_styles-&#x27; . $slideshow_page, create_function( &#x27;&#x27;, &quot;wp_enqueue_style(&#x27;wpp-jquery-fancybox-css&#x27;);&quot; ) );

      }

      /**
       * Property Settings page - Slideshow Tab content
       *
       * @todo Code needs to be revised and cleaned up.
       * @since 3.1
       *
       */
      function settings_page() {
        global $wp_properties, $wpdb, $class_wpp_slideshow;

        $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ] = WPP_F::array_merge_recursive_distinct( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ], $class_wpp_slideshow );
        $glob_slideshow                                                        = $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ];
        $property_slideshow                                                    = $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;property&#x27; ];

        if( !isset( $glob_slideshow[ &#x27;display_attributes&#x27; ] ) || !is_array( $glob_slideshow[ &#x27;display_attributes&#x27; ] ) ) {
          $glob_slideshow[ &#x27;display_attributes&#x27; ] = array();
        }

        $wpp_slideshow_display_attribs[ &#x27;post_title&#x27; ] = &quot;Property Title&quot;;

        foreach( $wp_properties[ &#x27;property_stats&#x27; ] as $slug =&gt; $title ) {
          $wpp_slideshow_display_attribs[ $slug ] = $title;
        }

        $dropdown_options[ &#x27;effect&#x27; ]    = array( &#x27;sliceDown&#x27;, &#x27;sliceDownLeft&#x27;, &#x27;sliceUp&#x27;, &#x27;sliceUpLeft&#x27;, &#x27;sliceUpDown&#x27;, &#x27;sliceUpDownLeft&#x27;, &#x27;fold&#x27;, &#x27;fade&#x27;, &#x27;random&#x27;, &#x27;slideInRight&#x27;, &#x27;slideInLeft&#x27;, &#x27;boxRandom&#x27;, &#x27;boxRain&#x27;, &#x27;boxRainReverse&#x27;, &#x27;boxRainGrow&#x27;, &#x27;boxRainGrowReverse&#x27; );
        $dropdown_options[ &#x27;slices&#x27; ]    = array( &#x27;5&#x27;, &#x27;10&#x27;, &#x27;15&#x27;, &#x27;20&#x27;, &#x27;30&#x27;, &#x27;40&#x27; );
        $dropdown_options[ &#x27;animSpeed&#x27; ] = array( &#x27;100&#x27;, &#x27;500&#x27;, &#x27;1000&#x27;, &#x27;2000&#x27;, &#x27;5000&#x27; );
        $dropdown_options[ &#x27;pauseTime&#x27; ] = array( &#x27;2500&#x27;, &#x27;5000&#x27;, &#x27;10000&#x27; );

        if( empty( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;effect&#x27; ] ) )
          $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;effect&#x27; ] = &#x27;fold&#x27;;

        if( empty( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;slices&#x27; ] ) )
          $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;slices&#x27; ] = &#x27;20&#x27;;

        if( empty( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;animSpeed&#x27; ] ) )
          $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;animSpeed&#x27; ] = &#x27;500&#x27;;

        if( empty( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;pauseTime&#x27; ] ) )
          $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;pauseTime&#x27; ] = &#x27;5000&#x27;;

        ?&gt;
        &lt;table class=&quot;form-table&quot;&gt;

  &lt;tr&gt;
    &lt;th&gt;&lt;?php _e( &#x27;Global Slideshow&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/th&gt;
    &lt;td&gt;
      &lt;ul&gt;

      &lt;li&gt;
      &lt;?php echo WPP_F::checkbox( &quot;name=wpp_settings[configuration][feature_settings][slideshow][glob][link_to_property]&amp;label=&quot; . __( &#x27;Clicking on an image will open up the property its attached to.&#x27;, &#x27;wpp&#x27; ), $glob_slideshow[ &#x27;link_to_property&#x27; ] ); ?&gt;
      &lt;/li&gt;

      &lt;li&gt;
      &lt;?php echo WPP_F::checkbox( &quot;name=wpp_settings[configuration][feature_settings][slideshow][glob][show_property_title]&amp;label=&quot; . __( &#x27;Show property title and tagline in slideshow.&#x27;, &#x27;wpp&#x27; ), $glob_slideshow[ &#x27;show_property_title&#x27; ] ); ?&gt;
      &lt;/li&gt;

      &lt;li&gt;
        &lt;label for=&quot;wpp_slideshow_global_size&quot;&gt;&lt;?php _e( &#x27;Slideshow Size: &#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/label&gt;
        &lt;select id=&quot;wpp_slideshow_global_size&quot; name=&quot;wpp_settings[configuration][feature_settings][slideshow][glob][image_size]&quot;&gt;
          &lt;option value=&quot;&quot;&gt;&lt;/option&gt;
          &lt;?php
          $wpp_image_sizes = $wp_properties[ &#x27;image_sizes&#x27; ];
          foreach( get_intermediate_image_sizes() as $slug ) {
            $selected         = &#x27;&#x27;;
            $slug             = trim( $slug );
            $image_dimensions = WPP_F::image_sizes( $slug, &quot;return_all=true&quot; );
            /* Skip images w/o dimensions */
            if( !$image_dimensions ) continue;
            if( $glob_slideshow[ &#x27;image_size&#x27; ] == $slug ) {
              $selected = &#x27;selected=&quot;selected&quot;&#x27;;
            }
            echo &#x27;&lt;option &#x27; . $selected . &#x27; value=&quot;&#x27; . $slug . &#x27;&quot; &gt;&#x27; . $slug . &#x27; - &#x27; . $image_dimensions[ &#x27;width&#x27; ] . &#x27;px x &#x27; . $image_dimensions[ &#x27;height&#x27; ] . &#x27;px&lt;/option&gt;&#x27;;

          }
          ?&gt;
         &lt;/select&gt;
         &lt;br class=&quot;cb&quot;/&gt;
         &lt;span class=&quot;description&quot;&gt;
		 &lt;?php printf( __( &#x27;The global slideshow will look for all images that are over the specified size.  Add images to the global slideshow &lt;a href=&quot;%1$s&quot;&gt;here&lt;/a&gt;. The built-in sizes, such as &lt;b&gt;medium&lt;/b&gt; and &lt;b&gt;large&lt;/b&gt; may not work because WordPress does not crop them during resizing, resulting in artbitrary heights. &#x27;, &#x27;wpp&#x27; ), admin_url( &quot;edit.php?post_type=property&amp;page=slideshow&quot; ) ); ?&gt;

         &lt;/span&gt;
         &lt;/li&gt;
       &lt;/ul&gt;

    &lt;/td&gt;
  &lt;/tr&gt;

  &lt;tr&gt;
    &lt;th&gt;&lt;?php _e( &#x27;Display in Global Slideshow Caption:&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/th&gt;
    &lt;td&gt;
      &lt;ul&gt;

        &lt;li&gt;&lt;?php echo WPP_F::checkbox( &quot;name=wpp_settings[configuration][feature_settings][slideshow][glob][show_title]&amp;label=&quot; . __( &#x27;Title.&#x27;, &#x27;wpp&#x27; ), $glob_slideshow[ &#x27;show_title&#x27; ] ); ?&gt;&lt;/li&gt;
        &lt;li&gt;&lt;?php echo WPP_F::checkbox( &quot;name=wpp_settings[configuration][feature_settings][slideshow][glob][show_excerpt]&amp;label=&quot; . __( &#x27;Excerpt.&#x27;, &#x27;wpp&#x27; ), $glob_slideshow[ &#x27;show_excerpt&#x27; ] ); ?&gt;&lt;/li&gt;
        &lt;li&gt;&lt;?php echo WPP_F::checkbox( &quot;name=wpp_settings[configuration][feature_settings][slideshow][glob][show_tagline]&amp;label=&quot; . __( &#x27;Tagline.&#x27;, &#x27;wpp&#x27; ), $glob_slideshow[ &#x27;show_tagline&#x27; ] ); ?&gt;&lt;/li&gt;
    &lt;/ul&gt;
    &lt;/td&gt;
  &lt;/tr&gt;

   &lt;tr&gt;
    &lt;th&gt;&lt;?php _e( &#x27;Single Listing Slideshow&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/th&gt;
    &lt;td&gt;
      &lt;ul&gt;

        &lt;li&gt;
          &lt;select name=&quot;wpp_settings[configuration][feature_settings][slideshow][property][image_size]&quot;&gt;
            &lt;option value=&quot;&quot;&gt;&lt;/option&gt;
            &lt;?php
            $wpp_image_sizes = $wp_properties[ &#x27;image_sizes&#x27; ];
            foreach( get_intermediate_image_sizes() as $slug ) {
              $selected         = &#x27;&#x27;;
              $slug             = trim( $slug );
              $image_dimensions = WPP_F::image_sizes( $slug, &quot;return_all=true&quot; );
              /* Skip images w/o dimensions */
              if( !$image_dimensions ) continue;
              if( $property_slideshow[ &#x27;image_size&#x27; ] == $slug ) {
                $selected = &#x27;selected=&quot;selected&quot;&#x27;;
              }
              echo &#x27;&lt;option &#x27; . $selected . &#x27; value=&quot;&#x27; . $slug . &#x27;&quot;&gt;&#x27; . $slug . &#x27; - &#x27; . $image_dimensions[ &#x27;width&#x27; ] . &#x27;px x &#x27; . $image_dimensions[ &#x27;height&#x27; ] . &#x27;px&lt;/option&gt;&#x27;;
            }
            ?&gt;
          &lt;/select&gt;
          &lt;br/&gt;
          &lt;span class=&quot;description&quot;&gt;&lt;?php _e( &#x27;Slideshow image size to be used for single property pages.&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/span&gt;
        &lt;/li&gt;

        &lt;li&gt;
          &lt;?php echo WPP_F::checkbox( &quot;name=wpp_settings[configuration][feature_settings][slideshow][property][navigation]&amp;label=&quot; . __( &#x27;Show pagination buttons in slideshow.&#x27;, &#x27;wpp&#x27; ), $property_slideshow[ &#x27;navigation&#x27; ] ); ?&gt;
        &lt;/li&gt;

      &lt;/ul&gt;
    &lt;/td&gt;
   &lt;/tr&gt;

  &lt;tr&gt;
    &lt;th&gt;
    &lt;?php _e( &#x27;Thumbnail Size&#x27;, &#x27;wpp&#x27; ); ?&gt;
    &lt;/th&gt;
    &lt;td&gt;
      &lt;p&gt;
        &lt;?php WPP_F::image_sizes_dropdown( &quot;name=wpp_settings[configuration][feature_settings][slideshow][glob][thumb_width]&amp;selected={$glob_slideshow[&#x27;thumb_width&#x27;]}&quot; ); ?&gt;
        &lt;span class=&quot;description&quot;&gt;&lt;?php _e( &#x27;This width is used on &quot;Slideshow&quot; page on the Property editing page to display available images, this setting &lt;b&gt;does not&lt;/b&gt; affect the actual slideshow on the front-end.&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/span&gt;
      &lt;/p&gt;
    &lt;/td&gt;
   &lt;/tr&gt;
   &lt;tr&gt;
    &lt;th&gt;
    &lt;?php _e( &#x27;Settings&#x27;, &#x27;wpp&#x27; ); ?&gt;
    &lt;/th&gt;
    &lt;td&gt;
      &lt;ul&gt;
        &lt;li&gt;
          &lt;label for=&quot;wpp_sllideshow_effect&quot;&gt;&lt;?php _e( &#x27;Effect:&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/label&gt;
          &lt;select id=&quot;wpp_sllideshow_effect&quot; name=&quot;wpp_settings[configuration][feature_settings][slideshow][glob][settings][effect]&quot;&gt;
            &lt;?php foreach( $dropdown_options[ &#x27;effect&#x27; ] as $effect ): ?&gt;
              &lt;option &lt;?php selected( $effect, $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;effect&#x27; ] ); ?&gt;value=&quot;&lt;?php echo $effect; ?&gt;&quot;&gt;&lt;?php echo $effect; ?&gt;&lt;/option&gt;
            &lt;?php endforeach; ?&gt;
          &lt;/select&gt;
          &lt;span class=&quot;description&quot;&gt;&lt;?php _e( &#x27;Effect that will be used to change from one image to the next.&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/span&gt;
        &lt;/li&gt;

        &lt;li&gt;
          &lt;label for=&quot;wpp_sllideshow_slices&quot;&gt;&lt;?php _e( &#x27;Slices:&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/label&gt;
          &lt;select id=&quot;wpp_sllideshow_slices&quot; name=&quot;wpp_settings[configuration][feature_settings][slideshow][glob][settings][slices]&quot;&gt;
            &lt;?php foreach( $dropdown_options[ &#x27;slices&#x27; ] as $slices ): ?&gt;
              &lt;option &lt;?php selected( $slices, $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;slices&#x27; ] ); ?&gt;value=&quot;&lt;?php echo $slices; ?&gt;&quot;&gt;&lt;?php echo $slices; ?&gt;&lt;/option&gt;
            &lt;?php endforeach; ?&gt;
          &lt;/select&gt;
          &lt;span class=&quot;description&quot;&gt;&lt;?php _e( &#x27;If the transition includes slices, this number determines how many slices to cut the image up into during transitions.&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/span&gt;
        &lt;/li&gt;

        &lt;li&gt;
          &lt;label for=&quot;wpp_sllideshow_anim_speed&quot;&gt;&lt;?php _e( &#x27;Animation Speed:&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/label&gt;
          &lt;select id=&quot;wpp_sllideshow_slices&quot; name=&quot;wpp_settings[configuration][feature_settings][slideshow][glob][settings][animSpeed]&quot;&gt;
            &lt;?php foreach( $dropdown_options[ &#x27;animSpeed&#x27; ] as $animSpeed ): ?&gt;
              &lt;option &lt;?php selected( $animSpeed, $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;animSpeed&#x27; ] ); ?&gt;value=&quot;&lt;?php echo $animSpeed; ?&gt;&quot;&gt;&lt;?php echo $animSpeed; ?&gt;&lt;/option&gt;
            &lt;?php endforeach; ?&gt;
          &lt;/select&gt;
          &lt;span class=&quot;description&quot;&gt;&lt;?php _e( &#x27;How quickly the transition should happen, in miliseconds.&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/span&gt;
        &lt;/li&gt;

        &lt;li&gt;
          &lt;label for=&quot;wpp_sllideshow_pause&quot;&gt;&lt;?php _e( &#x27;Pause Time:&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/label&gt;
          &lt;select id=&quot;wpp_sllideshow_pause&quot; name=&quot;wpp_settings[configuration][feature_settings][slideshow][glob][settings][pauseTime]&quot;&gt;
            &lt;?php foreach( $dropdown_options[ &#x27;pauseTime&#x27; ] as $pauseTime ): ?&gt;
              &lt;option &lt;?php selected( $pauseTime, $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;pauseTime&#x27; ] ); ?&gt;value=&quot;&lt;?php echo $pauseTime; ?&gt;&quot;&gt;&lt;?php echo $pauseTime; ?&gt;&lt;/option&gt;
            &lt;?php endforeach; ?&gt;
          &lt;/select&gt;
          &lt;span class=&quot;description&quot;&gt;&lt;?php _e( &#x27;The pause time between transitions.&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/span&gt;
        &lt;/li&gt;

      &lt;/ul&gt;

    &lt;/td&gt;
   &lt;/tr&gt;



  &lt;/table&gt;

      &lt;?php
      }

      /**
       * Global slideshow selection page.
       *
       * @todo Make image selection panes resizable.
       * @since 3.1
       *
       */
      function page_global_slideshow() {
        /* Get all images that are big enough  */
        global $wpdb, $wp_properties;

        $image_type  = $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;image_size&#x27; ];
        $image_sizes = WPP_F::image_sizes( $image_type );

        $glob_slideshow[ 0 ] = $image_sizes[ &#x27;width&#x27; ];
        $glob_slideshow[ 1 ] = $image_sizes[ &#x27;height&#x27; ];

        if( empty( $glob_slideshow[ 0 ] ) || empty( $glob_slideshow[ 0 ] ) ) {
          ?&gt;
          &lt;div class=&quot;wrap&quot;&gt;
    &lt;h2&gt;&lt;?php _e( &#x27;Global Slideshow&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/h2&gt;
    &lt;p&gt;
    Please visit the &lt;a href=&quot;&lt;?php echo admin_url( &quot;edit.php?post_type=property&amp;page=property_settings#tab_slideshow&quot; ); ?&gt;&quot;&gt;slideshow settings page&lt;/a&gt; and select the global slideshow size first.
    &lt;/p&gt;
  &lt;/div&gt;
          &lt;?php
          return;
        }

        $thumb_type = ( !empty( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] )
        &amp;&amp; !is_numeric( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] )
        &amp;&amp; $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] != &#x27;-&#x27; ? $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;thumb_width&#x27; ] : &#x27;thumbnail&#x27; );

        $thumb_info = WPP_F::image_sizes( $thumb_type );

        $image_type     = $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;property&#x27; ][ &#x27;image_size&#x27; ];
        $prop_slideshow = WPP_F::image_sizes( $image_type );

        if( empty( $prop_slideshow[ &#x27;width&#x27; ] ) )
          $prop_slideshow[ &#x27;width&#x27; ] = &#x27;640&#x27;;

        if( empty( $prop_slideshow[ &#x27;height&#x27; ] ) )
          $prop_slideshow[ &#x27;height&#x27; ] = &#x27;235&#x27;;

        /* If updating  */
        if( wp_verify_nonce( $_REQUEST[ &#x27;_wpnonce&#x27; ], &#x27;wpp_update_slideshow&#x27; )
          &amp;&amp; isset( $_POST[ &#x27;slideshow_image_array&#x27; ] )
        ) {

          /* fix array  */
          $string_array = $_POST[ &#x27;slideshow_image_array&#x27; ];
          $string_array = str_replace( &#x27;item=&#x27;, &#x27;&#x27;, $string_array );

          if( $string_array )
            $image_array = explode( &#x27;&amp;&#x27;, $string_array );

          update_option( &#x27;class_wpp_slideshow_image_array&#x27;, $image_array );

          require_once( ABSPATH . &#x27;/wp-admin/includes/image.php&#x27; );

          if( is_array( $image_array ) )
            foreach( (array) $image_array as $image ) {
              $orig_image   = get_attached_file( $image );
              $resized_path = image_resize( $orig_image, $glob_slideshow[ 0 ], $glob_slideshow[ 1 ], true );
            }

          $updated = __( &#x27;Slideshow selection and order saved.&#x27;, &#x27;wpp&#x27; );
        }

        /* Get current images  */
        $current = get_option( &#x27;class_wpp_slideshow_image_array&#x27; );

        $good_images = class_wpp_slideshow::get_global_images( &#x27;featured_property_images&#x27; );

        ?&gt;


        &lt;style type=&quot;text/css&quot;&gt;

  .wpp_slideshow_global_selected {
    clear: right;
    display: block;
    float: right;
    position: relative;
    margin-right: 20px;
    width: &lt;?php echo ($thumb_info[&#x27;width&#x27;] + 20); ?&gt;px;
  }

  .wpp_slideshow_global_all {

    clear: left;
    float: left;
    margin-right: -&lt;?php echo ($thumb_info[&#x27;width&#x27;] + 100); ?&gt;px;
    width: 100%;
  }

  .wpp_slideshow_global_all_inner {
    position: relative;
    margin-right: &lt;?php echo ($thumb_info[&#x27;width&#x27;] + 60); ?&gt;px;

  }

  .wpp_slideshow_global_all_inner #sortable1 {
    overflow: auto;
  }

  .wpp_slideshow_global_all_inner .wpp_slideshow_global_all_inner_menu {
    position: absolute;
    right: 11px;
    text-align: right;
    top: 0;
    width: 440px;
  }

  .wpp_slideshow_image_block {
    float: left;
    padding: 0;
    margin: 0px;
    position: relative;
  }

  .wpp_slideshow_image_block img.wpp_image_element {
    margin: 0;
    padding: 0;
    max-width: 100%;
    max-height: auto;
  }

  #wpp_slideshow_remove_all,
  #wpp_slideshow_show_help,
  #wpp_slideshow_auto_add {
    cursor: pointer;
  }

  .wpp_slideshow_postbox_description {
    display: none;
    background-color: #FFFFE0;
    margin: 5px 0 15px;
    border-color: #E6DB55;
    -moz-border-radius: 3px 3px 3px 3px;
    border-style: solid;
    border-width: 1px;
    padding: 0 0.6em;
  }

  #sortable1, #sortable2 {
    background: none repeat scroll 0 0 #EDEDEF;
    border: 7px solid #BABABA;
    list-style-type: none;
    margin: 0 10px 0 0;
    min-height: 300px;
    padding: 10px;
  }

  .image_block .title {
    font-size: 1.4em;
  }

  #sortable1 li, #sortable2 li {
    font-size: 1.2em;

    padding: 0 0 6px;
    text-align: center;
    width: &lt;?php echo $thumb_info[&#x27;thumb_width&#x27;]; ?&gt;px;
  }

  #sortable1 li img, #sortable2 li img {
    border: 1px solid #888888;
    cursor: move;
  }

  #sortable1 {
    border: 7px solid #DADADA;
    min-height: 300px;
    min-width: &lt;?php echo $thumb_info[&#x27;width&#x27;] + 10; ?&gt;px;
  }

  #sortable2 {
    background: none repeat scroll 0 0 #F8FFC6;
    border: 7px solid #D5CD9C;
    min-height: 300px;
    min-width: &lt;?php echo $thumb_info[&#x27;width&#x27;] + 10; ?&gt;px;
  }

  .wpp_selected_images_title, .wpp_all_images_title {
    display: table;
    padding: 10px;
    font-size: 1.3em;
    font-weight: bold;
  }

  .wpp_selected_images_title {
    background: #D5CD9C;
  }

  .wpp_all_images_title {
    background: #DADADA;
  }

  .wpp_slideshow_image_stats.image_does_not_exist {
    background: none repeat scroll 0 0 #FFCFCF;
    border: 1px solid #BB8C8C;
    color: #543636;
    left: 2%;
    position: absolute;
    top: 4px;
    width: 93%;
  }

  .wpp_slideshow_image_stats.image_exists {
    background: none repeat scroll 0 0 #BDEABC;
    border: 1px solid #57B873;
    color: #46704F;
  }
  &lt;/style&gt;&lt;!-- styles --&gt;


        &lt;script type=&quot;text/javascript&quot;&gt;

    jQuery( document ).ready( function() {

      wpp_slideshow_resize_global_all();

      jQuery( &quot;#wpp_slideshow_show_help&quot; ).click( function() {
        jQuery( &quot;.wpp_slideshow_postbox_description&quot; ).toggle();
      } );

      jQuery( &quot;#wpp_slideshow_auto_add&quot; ).click( function() {
        wpp_slideshow_auto_add();
      } );

      jQuery( &quot;#wpp_slideshow_remove_all&quot; ).click( function() {
        wpp_slideshow_remove_all();
      } );

      jQuery( &quot;#sortable1, #sortable2&quot; ).sortable( {
        connectWith: &#x27;.connectedSortable&#x27;,
        update: function() {
          wpp_slideshow_update_order();
        }
      } ).disableSelection();

      jQuery( &#x27;#wpp_slideshow_global_filter&#x27; ).change( function() {

        wpp_slideshow_get_global_images();

      } );

    } );

    function wpp_slideshow_get_global_images() {

      var selection = jQuery( &#x27;option:selected&#x27;, jQuery( &quot;#wpp_slideshow_global_filter&quot; ) ).val();

      jQuery( &quot;#sortable1&quot; ).html( &#x27;&lt;?php _e(&#x27;Loading...&#x27;, &#x27;wpp&#x27;); ?&gt;&#x27; );

      jQuery.post( wpp.instance.ajax_url, {action: &quot;wpp_slideshow_get_global_images&quot;, selection: selection, _wpnonce: &#x27;&lt;?php echo wp_create_nonce(&#x27;wpp_get_global_images&#x27;); ?&gt;&#x27;}, function( result ) {
        jQuery( &quot;#sortable1&quot; ).html( result );
      } );
    }

    function wpp_slideshow_remove_all() {

      jQuery( &quot;#sortable2 .wpp_slideshow_image_block&quot; ).each( function() {
        jQuery( this ).appendTo( &quot;#sortable1&quot; );
      } );

      wpp_slideshow_update_order();
    }

    function wpp_slideshow_auto_add() {

      jQuery( &quot;#sortable1 .wpp_slideshow_image_block&quot; ).each( function() {
        if( jQuery( this ).attr( &quot;can_use&quot; ) == &#x27;true&#x27; ) {
          jQuery( this ).appendTo( &quot;#sortable2&quot; );
        }
      } );
      jQuery( &quot;#sortable2 .wpp_slideshow_image_block&quot; ).each( function() {
        if( jQuery( this ).attr( &quot;can_use&quot; ) == &#x27;false&#x27; ) {
          jQuery( this ).appendTo( &quot;#sortable1&quot; );
        }
      } );
      wpp_slideshow_update_order();

    }

    function wpp_slideshow_resize_global_all() {

      var height = jQuery( &quot;.wpp_slideshow_global_selected&quot; ).height();

      if( height &gt; 400 )
        jQuery( &quot;.wpp_slideshow_global_all_inner #sortable1&quot; ).css( &quot;height&quot;, (height - 70) ); else
        jQuery( &quot;.wpp_slideshow_global_all_inner #sortable1&quot; ).css( &quot;height&quot;, 400 );

    }

    function wpp_slideshow_update_order() {
      var order = jQuery( &#x27;#sortable2&#x27; ).sortable( &#x27;serialize&#x27;, {key: &#x27;item&#x27;} );
      if( order != &#x27;&#x27; ) {
        jQuery( &quot;#slideshow_image_array&quot; ).val( order );
      } else {
        jQuery( &quot;#slideshow_image_array&quot; ).val( &#x27;item=&#x27; );
      }
    }


  &lt;/script&gt;&lt;!-- sorting scripts --&gt;

        &lt;div class=&quot;wrap&quot;&gt;
  &lt;h2&gt;&lt;?php _e( &#x27;Global Slideshow&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/h2&gt;

          &lt;?php if( $updated ): ?&gt;
            &lt;div class=&quot;updated fade&quot;&gt;&lt;p&gt;&lt;?php echo $updated; ?&gt;&lt;/p&gt;&lt;/div&gt;
          &lt;?php endif; ?&gt;
          &lt;div class=&quot;wpp_slideshow_postbox_description &quot;&gt;
    &lt;p&gt;Please ensure the images are large enough for the slideshow. The image sizes for the slideshow are set on &lt;a href=&quot;&lt;?php echo admin_url( &quot;edit.php?post_type=property&amp;page=property_settings#tab_slideshow&quot; ); ?&gt;&quot;&gt;Slideshow Settings Page&lt;/a&gt;.  If an image is too small, it will not be included in the actual slideshow.  To avoid pixelation, WP-Property will never stretch out your images. &lt;/p&gt;
    &lt;p&gt;Current size: &lt;b&gt;&lt;?php echo $prop_slideshow[ &#x27;width&#x27; ]; ?&gt;px&lt;/b&gt; by &lt;b&gt;&lt;?php echo $prop_slideshow[ &#x27;height&#x27; ]; ?&gt;
        px&lt;/b&gt;, using &lt;b&gt;&lt;?php echo $image_type; ?&gt;&lt;/b&gt;.&lt;/p&gt;
            &lt;?php if( class_exists( &#x27;RegenerateThumbnails&#x27; ) ): ?&gt;
              &lt;p&gt;If you create a new image size, be sure to &lt;a href=&quot;&lt;?php echo admin_url( &quot;tools.php?page=regenerate-thumbnails&quot; ); ?&gt;&quot;&gt;regenerate your thumbnails&lt;/a&gt;. &lt;/p&gt;
            &lt;?php else: ?&gt;
              &lt;p&gt;If you create a new image size, be sure to regenerate your thumbnails using the &lt;a href=&quot;http://wordpress.org/extend/plugins/regenerate-thumbnails/&quot;&gt;Regenerate Thumbnails&lt;/a&gt;.&lt;/p&gt;
            &lt;?php endif; ?&gt;
  &lt;/div&gt;
  &lt;form action=&quot;&lt;?php admin_url( &#x27;edit.php?post_type=property&amp;page=slideshow&#x27; ); ?&gt;&quot; method=&quot;post&quot;&gt;
   &lt;div class=&quot;wpp_box&quot;&gt;
    &lt;div class=&quot;wpp_box_header&quot;&gt;
       &lt;strong&gt;&lt;?php _e( &#x27;WP-Property Slideshow&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/strong&gt;
       &lt;p&gt;&lt;?php _e( &#x27;This slideshow can be integrated into your front-end pages by either using the shortcode, or pasting PHP code into your theme.&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class=&quot;wpp_box_content&quot;&gt;
       &lt;p&gt;&lt;?php _e( &#x27;Drag images from selection on the left to the selection on the right, and then click save.&#x27;, &#x27;wpp&#x27; ); ?&gt;&lt;/p&gt;
       &lt;p&gt;&lt;?php echo sprintf( __( &#x27;This list gets all images from your media library that are over %s pixels wide and %s pixels tall.&#x27;, &#x27;wpp&#x27; ), $glob_slideshow[ 0 ], $glob_slideshow[ 1 ] ); ?&gt;&lt;/p&gt;
       &lt;input type=&quot;hidden&quot; name=&quot;_wpnonce&quot; value=&quot;&lt;?php echo wp_create_nonce( &#x27;wpp_update_slideshow&#x27; ); ?&gt;&quot;/&gt;
       &lt;input type=&quot;hidden&quot; name=&quot;slideshow_image_array&quot; id=&quot;slideshow_image_array&quot; value=&quot;&quot;/&gt;
    &lt;/div&gt;


    &lt;div class=&quot;wpp_box_footer&quot;&gt;
        &lt;input type=&quot;submit&quot; value=&quot;&lt;?php _e( &#x27;Save Selection and Order&#x27;, &#x27;wpp&#x27; ) ?&gt;&quot; accesskey=&quot;p&quot; tabindex=&quot;4&quot; id=&quot;publish&quot; class=&quot;button-primary btn&quot; name=&quot;save&quot;&gt;
    &lt;/div&gt;
   &lt;/div&gt;
  &lt;/form&gt;



  &lt;div class=&quot;wpp_slideshow_images&quot;&gt;
  &lt;div class=&quot;wpp_slideshow_global_selected image_block&quot;&gt;
   &lt;span class=&quot;wpp_selected_images_title&quot;&gt; &lt;?php _e( &#x27;Slideshow Images:&#x27;, &#x27;wpp&#x27; ) ?&gt;&lt;/span&gt;
   &lt;ul id=&quot;sortable2&quot; class=&quot;connectedSortable clearfix&quot;&gt;
   &lt;?php
   if( is_array( $current ) ):
     foreach( $current as $curr_id ):

       if( $curr_id ) {
         class_wpp_slideshow::draggable_image_block( $curr_id, $image_type );
       }
     endforeach; endif; ?&gt;
   &lt;/ul&gt;
  &lt;/div&gt;
  &lt;div class=&quot;wpp_slideshow_global_all image_block&quot;&gt;
  &lt;div class=&quot;wpp_slideshow_global_all_inner&quot;&gt;
   &lt;span class=&quot;wpp_all_images_title&quot;&gt;&lt;?php _e( &#x27;All Images:&#x27;, &#x27;wpp&#x27; ) ?&gt;&lt;/span&gt;

    &lt;div class=&quot;wpp_slideshow_global_all_inner_menu&quot;&gt;

      Show:
      &lt;select id=&quot;wpp_slideshow_global_filter&quot;&gt;
        &lt;option selected=&quot;true&quot; value=&quot;featured_property_images&quot;&gt;Primary Property Images&lt;/option&gt;
        &lt;option value=&quot;all_property_images&quot;&gt;All Property Images&lt;/option&gt;
        &lt;option value=&quot;all_images&quot;&gt;All Images&lt;/option&gt;
      &lt;/select&gt;

      &lt;span class=&quot;description&quot; id=&quot;wpp_slideshow_show_help&quot;&gt;Help&lt;/span&gt; |
      &lt;span class=&quot;description&quot; id=&quot;wpp_slideshow_auto_add&quot;&gt;Auto Fix&lt;/span&gt; |
      &lt;span class=&quot;description&quot; id=&quot;wpp_slideshow_remove_all&quot;&gt;Remove All&lt;/span&gt;
    &lt;/div&gt;

   &lt;ul id=&quot;sortable1&quot; class=&quot;connectedSortable clearfix&quot;&gt;
    &lt;?php
    foreach( (array) $good_images as $image_obj ) {

      $image = $image_obj[ &#x27;image_id&#x27; ];
      /* skip if current  */
      if( is_array( $current ) )
        if( in_array( $image, $current ) )
          continue;

      class_wpp_slideshow::draggable_image_block( $image, $image_type, true, $image_obj );

    }
    ?&gt;
   &lt;/ul&gt;
  &lt;/div&gt;
  &lt;/div&gt;



  &lt;/div&gt;&lt;!-- /div.wrap --&gt;
  &lt;/div&gt;&lt;!-- /div.wrap --&gt;


      &lt;?php
      }

      /**
       * Main function for rendering a slideshow.
       *
       * http://galleria.aino.se/docs/1.2/options/#list-of-options
       *
       * @param array settings Settings passed by shortcodes to identify the type of slideshow, or configure it.
       *
       * @since 3.5.0
       */
      function display_gallery( $settings = false ) {
        global $wp_query, $wp_properties;

        $defaults = array(
          &#x27;width&#x27;                       =&gt; &#x27;auto&#x27;,
          &#x27;height&#x27;                      =&gt; &#x27;auto&#x27;,
          &#x27;autoplay&#x27;                    =&gt; false,
          &#x27;transition&#x27;                  =&gt; &#x27;fade&#x27;,
          &#x27;enforce_minimum_image_width&#x27; =&gt; &#x27;true&#x27;,
          &#x27;debug&#x27;                       =&gt; &#x27;false&#x27;,

          &#x27;thumb_size&#x27;                  =&gt; &#x27;thumbnail&#x27;,
          &#x27;image_size&#x27;                  =&gt; &#x27;medium&#x27;,
          &#x27;large_size&#x27;                  =&gt; &#x27;large&#x27;,

          &#x27;hide_if_no_images&#x27;           =&gt; &#x27;false&#x27;,

          &#x27;show_info&#x27;                   =&gt; &#x27;true&#x27;,
          &#x27;carousel&#x27;                    =&gt; &#x27;true&#x27;,
          &#x27;image_crop&#x27;                  =&gt; &#x27;true&#x27;,
          &#x27;image_pan&#x27;                   =&gt; &#x27;true&#x27;,
          &#x27;theme&#x27;                       =&gt; &#x27;classic/galleria.classic.min.js&#x27;,
          &#x27;element&#x27;                     =&gt; &#x27;wpp_gallery_&#x27; . rand( 1000, 9999 )
        );

        if( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;developer_mode&#x27; ] == &#x27;true&#x27; ) {
          $defaults[ &#x27;debug&#x27; ] = &#x27;true&#x27;;
        }

        //** Merge default settings with the passed through settings */
        $s = array_merge( $defaults, (array) $settings );

        if( is_array( $wp_query-&gt;query_vars[ &#x27;property&#x27; ] ) ) {
          $gallery = (array) $wp_query-&gt;query_vars[ &#x27;property&#x27; ][ &#x27;gallery&#x27; ];
          //** Get gallery images order */
          $gallery_order = array_filter( (array) maybe_unserialize( $wp_query-&gt;query_vars[ &#x27;property&#x27; ][ &#x27;gallery_images&#x27; ] ) );
          //** Get slideshow images order */
          $slideshow_order = array_filter( (array) maybe_unserialize( $wp_query-&gt;query_vars[ &#x27;property&#x27; ][ &#x27;slideshow_images&#x27; ] ) );
        }

        if( is_object( $wp_query-&gt;query_vars[ &#x27;property&#x27; ] ) ) {
          $gallery = (array) $wp_query-&gt;query_vars[ &#x27;property&#x27; ]-&gt;gallery;
          //** Get gallery images order */
          $gallery_order = array_filter( (array) maybe_unserialize( $wp_query-&gt;query_vars[ &#x27;property&#x27; ]-&gt;gallery_images ) );
          //** Get slideshow images order */
          $slideshow_order = array_filter( (array) maybe_unserialize( $wp_query-&gt;query_vars[ &#x27;property&#x27; ]-&gt;slideshow_images ) );
        }

        if( empty( $gallery ) ) {
          return false;
        }

        if( !$s[ &#x27;image_size&#x27; ] ) {
          return false;
        }

        $theme_locations = apply_filters( &#x27;wpp_property_gallery_theme_locations&#x27;, array(
          WPP_Path . &#x27;third-party/galleria/themes&#x27;,
          STYLESHEETPATH
        ) );

        if( !is_array( $theme_locations ) ) {
          return false;
        }

        foreach( $theme_locations as $theme_path ) {

          //** Locate theme */
          if( file_exists( $theme_path . &#x27;/&#x27; . $s[ &#x27;theme&#x27; ] ) ) {
            $found_theme = $theme_path . &#x27;/&#x27; . $s[ &#x27;theme&#x27; ];
            break;
          }

        }

        if( !$found_theme ) {
          return false;
        }

        /* Replace dir path to URL */
        $found_theme = str_replace( &#x27;\\&#x27;, &#x27;/&#x27;, $found_theme );
        $path        = str_replace( &#x27;\\&#x27;, &#x27;/&#x27;, ABSPATH );
        $theme_url   = str_replace( $path, get_bloginfo( &#x27;wpurl&#x27; ) . &#x27;/&#x27;, $found_theme );

        $expected_dimensions = WPP_F::image_sizes( $s[ &#x27;image_size&#x27; ] );

        $prepared_gallery_images = array();

        //** Calculate order of images */
        if( is_array( $slideshow_order ) &amp;&amp; is_array( $gallery_order ) ) {
          $order = array_merge( $slideshow_order, $gallery_order );

          //** Get images from the list of images by order */
          foreach( $order as $order_id ) {
            foreach( $gallery as $image_slug =&gt; $gallery_image_data ) {
              if( $gallery_image_data[ &#x27;attachment_id&#x27; ] == $order_id ) {
                $prepared_gallery_images[ $image_slug ] = $gallery_image_data;
                break;
              }
            }
          }

          //** Be sure we show ALL property images in gallery */
          // $gallery = array_merge($prepared_gallery_images, $gallery);
          // array_merge doesn&#x27;t store keys, let&#x27;s use + instead
          $gallery = $prepared_gallery_images + $gallery;

        }

        foreach( $gallery as $single ) {

          $single = (array) $single;

          //** Check in case get_posts() result is passed */
          if( empty( $single[ &#x27;attachment_id&#x27; ] ) &amp;&amp; isset( $single[ &#x27;ID&#x27; ] ) ) {
            $single[ &#x27;attachment_id&#x27; ] = $single[ &#x27;ID&#x27; ];
          }

          if( empty( $single[ &#x27;attachment_id&#x27; ] ) ) {
            continue;
          }

          if( !empty( $single[ &#x27;link_url&#x27; ] ) ) {
            $single_object[ &#x27;link_url&#x27; ] = $single[ &#x27;link_url&#x27; ];
          }

          $image = wpp_get_image_link( $single[ &#x27;attachment_id&#x27; ], $s[ &#x27;image_size&#x27; ], array( &#x27;return&#x27; =&gt; &#x27;array&#x27; ) );

          if( $image[ &#x27;width&#x27; ] != $expected_dimensions[ &#x27;width&#x27; ] &amp;&amp; $s[ &#x27;enforce_minimum_image_width&#x27; ] == &#x27;true&#x27; ) {
            continue;
          }

          $single_object[ &#x27;image&#x27; ] = $image[ &#x27;link&#x27; ];

          if( $s[ &#x27;thumb_size&#x27; ] ) {
            $thumb                    = wpp_get_image_link( $single[ &#x27;attachment_id&#x27; ], $s[ &#x27;thumb_size&#x27; ], array( &#x27;return&#x27; =&gt; &#x27;array&#x27; ) );
            $single_object[ &#x27;thumb&#x27; ] = $thumb[ &#x27;link&#x27; ];
          }

          if( $s[ &#x27;large_size&#x27; ] ) {
            $big                    = wpp_get_image_link( $single[ &#x27;attachment_id&#x27; ], $s[ &#x27;large_size&#x27; ], array( &#x27;return&#x27; =&gt; &#x27;array&#x27; ) );
            $single_object[ &#x27;big&#x27; ] = $big[ &#x27;link&#x27; ];
          }

          $single_object[ &#x27;title&#x27; ]       = $single[ &#x27;post_title&#x27; ];
          $single_object[ &#x27;description&#x27; ] = $single[ &#x27;post_content&#x27; ];
          $gallery_data[ ]                = $single_object;

          //** Set width and height to be used for wrapper based on image size */
          $width = ( $image[ &#x27;width&#x27; ] ? $image[ &#x27;width&#x27; ] . &#x27;px&#x27; : false );

          //** Add 60 pixels to compensate for the thumbnail size, which may be changed in CSS */
          $height = ( $image[ &#x27;height&#x27; ] ? $image[ &#x27;height&#x27; ] + 60 . &#x27;px&#x27; : false );
        }

        if( count( $gallery_data ) &lt; 1 ) {

          $no_images = true;

          if( $s[ &#x27;hide_if_no_images&#x27; ] == &#x27;true&#x27; ) {
            return;
          }

          $element_class[ ] = &#x27;wpp_galleria_no_images&#x27;;

        }

        $element_class[ ] = $s[ &#x27;element&#x27; ] . &#x27;_wrapper&#x27;;
        $element_class[ ] = &#x27;wpp_galleria_wrapper&#x27;;

        if( !empty( $s[ &#x27;width&#x27; ] ) &amp;&amp; is_numeric( $s[ &#x27;width&#x27; ] ) ) {
          $s[ &#x27;width&#x27; ] = $s[ &#x27;width&#x27; ] . &#x27;px&#x27;;
        }

        if( !empty( $s[ &#x27;height&#x27; ] ) &amp;&amp; is_numeric( $s[ &#x27;height&#x27; ] ) ) {
          $s[ &#x27;height&#x27; ] = $s[ &#x27;height&#x27; ] . &#x27;px&#x27;;
        }

        if( empty( $s[ &#x27;width&#x27; ] ) || ( $s[ &#x27;width&#x27; ] == &#x27;auto&#x27; &amp;&amp; !empty( $width ) ) ) {
          $s[ &#x27;width&#x27; ] = $width;
        }

        if( empty( $s[ &#x27;height&#x27; ] ) || ( $s[ &#x27;height&#x27; ] == &#x27;auto&#x27; &amp;&amp; !empty( $width ) ) ) {
          $s[ &#x27;height&#x27; ] = $height;
        }

        ob_start();

        if( $s[ &#x27;carousel&#x27; ] == &#x27;true&#x27; ) {

          ?&gt;

          &lt;?php if( !$no_images ) { ?&gt;

            &lt;script type=&quot;text/javascript&quot;&gt;

        var galleria_&lt;?php echo $s[&#x27;element&#x27;]; ?&gt;;

        function init_&lt;?php echo $s[&#x27;element&#x27;]; ?&gt;() {

          var gallery_element = jQuery( &quot;#&lt;?php echo $s[&#x27;element&#x27;]; ?&gt;:visible&quot; );

          if( typeof galleria_&lt;?php echo $s[&#x27;element&#x27;]; ?&gt; === &#x27;undefined&#x27; &amp;&amp; gallery_element.length ) {
            galleria_&lt;?php echo $s[&#x27;element&#x27;]; ?&gt; = gallery_element.galleria( {
              &lt;?php echo ($s[&#x27;image_crop&#x27;] == &#x27;true&#x27; ? &#x27;imageCrop: true,&#x27;: &#x27;&#x27;);?&gt;
              &lt;?php echo ($s[&#x27;transition&#x27;]  ? &#x27;transition: &quot;&#x27;.$s[&#x27;transition&#x27;].&#x27;&quot;,&#x27;: &#x27;&#x27;);?&gt;
              &lt;?php echo ($s[&#x27;image_pan&#x27;]  == &#x27;true&#x27; ? &#x27;imagePan: true,&#x27;: &#x27;&#x27;);?&gt;
              &lt;?php echo ($s[&#x27;autoplay&#x27;]  == &#x27;true&#x27; ? &#x27;autoplay: true,&#x27;: &#x27;&#x27;);?&gt;
              &lt;?php echo ($s[&#x27;debug&#x27;]  == &#x27;true&#x27; ? &#x27;debug: true,&#x27;: &#x27;debug: false,&#x27;);?&gt;
              &lt;?php echo (is_numeric($s[&#x27;carouselSpeed&#x27;]) ? &#x27;carouselSpeed: &#x27;.$s[&#x27;carouselSpeed&#x27;].&#x27;,&#x27;: &#x27;&#x27;);?&gt;
              showInfo: &lt;?php echo ($s[&#x27;show_info&#x27;]  == &#x27;true&#x27; ? &#x27;true&#x27;: &#x27;false&#x27;);?&gt;,
              width: &quot;&lt;?php echo ($s[&#x27;width&#x27;] ? $s[&#x27;width&#x27;] : &#x27;auto&#x27;);?&gt;&quot;,
              height: &quot;&lt;?php echo ($s[&#x27;height&#x27;] ? $s[&#x27;height&#x27;] : &#x27;auto&#x27;);?&gt;&quot;
            } );
          }
        }

        jQuery( document ).ready( function() {
          if( typeof Galleria !== &#x27;undefined&#x27; ) {
            Galleria.loadTheme( &quot;&lt;?php echo $theme_url; ?&gt;&quot; );
            jQuery( document ).bind( &quot;wpp::ui-tabs::tabsshow&quot;, function( e, ui ) {
              init_&lt;?php echo $s[&#x27;element&#x27;]; ?&gt;();
            } );
          }
        } );

        &lt;?php if (wp_script_is( &#x27;jquery-ui-tabs&#x27;, $list = &#x27;queue&#x27; )) : ?&gt;
        jQuery( window ).load( function() {
          init_&lt;?php echo $s[&#x27;element&#x27;]; ?&gt;();
        } );
        &lt;?php else: ?&gt;
        jQuery( document ).ready( function() {
          init_&lt;?php echo $s[&#x27;element&#x27;]; ?&gt;();
        } );
        &lt;?php endif;?&gt;

      &lt;/script&gt;
          &lt;?php } ?&gt;

          &lt;div class=&quot;&lt;?php echo implode( &#x27; &#x27;, $element_class ); ?&gt;&quot; style=&quot;width: &lt;?php echo $s[ &#x27;width&#x27; ]; ?&gt;; height: &lt;?php echo $s[ &#x27;height&#x27; ]; ?&gt;&quot;&gt;
      &lt;div id=&quot;&lt;?php echo $s[ &#x27;element&#x27; ]; ?&gt;&quot; class=&quot;wpp_galleria&quot; style=&quot;width: &lt;?php echo $s[ &#x27;width&#x27; ]; ?&gt;; height: &lt;?php echo $s[ &#x27;height&#x27; ]; ?&gt;&quot;&gt;
      &lt;?php if( is_array( $gallery_data ) ) {
        foreach( $gallery_data as $single ) {
          ?&gt;
          &lt;a &lt;?php echo( $single[ &#x27;big&#x27; ] ? &#x27;rel=&quot;&#x27; . $single[ &#x27;big&#x27; ] . &#x27;&quot;&#x27; : &#x27;&#x27; ); ?&gt; href=&quot;&lt;?php echo $single[ &#x27;image&#x27; ]; ?&gt;&quot;&gt;&lt;img src=&quot;&lt;?php echo $single[ &#x27;thumb&#x27; ]; ?&gt;&quot; &lt;?php echo( $single[ &#x27;link_url&#x27; ] ? &#x27;longdesc=&quot;&#x27; . $single[ &#x27;link_url&#x27; ] . &#x27;&quot;&#x27; : &#x27;&#x27; ); ?&gt; alt=&quot;&lt;?php echo esc_attr( $single[ &#x27;description&#x27; ] ) ?&gt;&quot; title=&quot;&lt;?php echo esc_attr( $single[ &#x27;title&#x27; ] ) ?&gt;&quot;&gt;&lt;/a&gt;
        &lt;?php
        }
      } ?&gt;
      &lt;/div&gt;
      &lt;/div&gt;
        &lt;?php

        } else {

          if( !$no_images ) {

            foreach( (array) $gallery_data as $image ) {
              ?&gt;
              &lt;div class=&quot;sidebar_gallery_item&quot;&gt;
              &lt;a href=&quot;&lt;?php echo $image[ &#x27;big&#x27; ]; ?&gt;&quot; class=&quot;fancybox_image thumbnail&quot; rel=&quot;property_gallery&quot;&gt;
                &lt;img src=&quot;&lt;?php echo $image[ &#x27;thumb&#x27; ]; ?&gt;&quot; title=&quot;&lt;?php echo $image[ &#x27;description&#x27; ] ?&gt;&quot; alt=&quot;&lt;?php echo $image[ &#x27;description&#x27; ] ?&gt;&quot; class=&quot;wpp_shortcode_gallery_image size-thumbnail&quot;/&gt;
              &lt;/a&gt;
          &lt;/div&gt;
            &lt;?php

            }

          }

        }

        $html = ob_get_contents();
        ob_end_clean();

        return $html;

      }

      /**
       * Main function for rendering a slideshow.
       *
       * @todo Finish function to automatically load images (tag:automatically_load_images)
       *
       * @param array settings Settings passed by shortcodes to identify the type of slideshow, or configure it.
       *
       * @since 3.1
       *
       */
      function display_slideshow( $settings = false ) {
        global $wp_properties, $wpdb;

        //** Support for legacy functions where first variable is the $post_id */
        if( is_numeric( $settings ) ) {
          $post_id = $settings;
        }

        if( $post_id ) {
          //** Check if $post_id was passed (shortcode function does not do this) */
          $post_id = $post_id;
        } elseif( !empty( $settings[ &#x27;id&#x27; ] ) ) {
          //** Check if post_id was passed using $atts */
          $post_id = $settings[ &#x27;id&#x27; ];
        } elseif( !$post_id &amp;&amp; $settings[ &#x27;type&#x27; ] == &#x27;single&#x27; ) {
          //** Get post_id form global variable */
          global $post;
          $post_id = $post-&gt;ID;
        } else {
          //** No post ID passed - global slideshow? */
          if( empty( $settings[ &#x27;type&#x27; ] ) || $settings[ &#x27;type&#x27; ] != &#x27;global&#x27; ) {

            return false;
          }
        }

        $defaults = array(
          &#x27;effect&#x27;                             =&gt; ( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;effect&#x27; ] ? $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;effect&#x27; ] : &#x27;fold&#x27; ),
          &#x27;slices&#x27;                             =&gt; ( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;slices&#x27; ] ? $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;slices&#x27; ] : &#x27;20&#x27; ),
          &#x27;animation_speed&#x27;                    =&gt; ( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;animSpeed&#x27; ] ? $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;animSpeed&#x27; ] : &#x27;500&#x27; ),
          &#x27;pause_time&#x27;                         =&gt; ( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;pauseTime&#x27; ] ? $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;settings&#x27; ][ &#x27;pauseTime&#x27; ] : &#x27;5000&#x27; ),
          &#x27;image_size&#x27;                         =&gt; false,
          &#x27;automatically_load_images&#x27;          =&gt; false,
          &#x27;show_pagination_buttons&#x27;            =&gt; ( $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;property&#x27; ][ &#x27;navigation&#x27; ] ? $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;property&#x27; ][ &#x27;navigation&#x27; ] : &#x27;false&#x27; ),
          &#x27;show_side_navigation&#x27;               =&gt; &#x27;true&#x27;,
          &#x27;show_side_navigation_on_hover_only&#x27; =&gt; &#x27;true&#x27;,
          &#x27;caption_opacity&#x27;                    =&gt; &#x27;0.8&#x27;
        );

        //** Merge default settings with the passed through settings */
        if( $settings ) {
          $settings = array_merge( $defaults, $settings );
        } else {
          $settings = $defaults;
        }

        do_action( &#x27;wpp::slideshow::property_slideshow&#x27;, $settings, !empty( $post_id ) ? $post_id : false );

        if( $settings[ &#x27;type&#x27; ] == &#x27;global&#x27; ) {
          //** Perform global slideshow specific actions */
          $images = get_option( &#x27;class_wpp_slideshow_image_array&#x27;, false );

          if( empty( $settings[ &#x27;image_size&#x27; ] ) ) {
            $settings[ &#x27;image_size&#x27; ] = $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;image_size&#x27; ];
          }

          if( empty( $settings[ &#x27;link_to_property&#x27; ] ) &amp;&amp; $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;link_to_property&#x27; ] == &#x27;true&#x27; ) {
            $settings[ &#x27;link_to_property&#x27; ] = &#x27;true&#x27;;
          }

          if( empty( $settings[ &#x27;show_title&#x27; ] ) &amp;&amp; $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;show_title&#x27; ] == &#x27;true&#x27; ) {
            $settings[ &#x27;show_title&#x27; ] = &#x27;true&#x27;;
          }

          if( empty( $settings[ &#x27;show_tagline&#x27; ] ) &amp;&amp; $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;show_tagline&#x27; ] == &#x27;true&#x27; ) {
            $settings[ &#x27;show_tagline&#x27; ] = &#x27;true&#x27;;
          }

          if( empty( $settings[ &#x27;show_excerpt&#x27; ] ) &amp;&amp; $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;show_excerpt&#x27; ] == &#x27;true&#x27; ) {
            $settings[ &#x27;show_excerpt&#x27; ] = &#x27;true&#x27;;
          }

        } elseif( $settings[ &#x27;type&#x27; ] == &#x27;single&#x27; ) {

          //** Perform single slideshow specific actions */
          $images = get_post_meta( $post_id, &#x27;slideshow_images&#x27;, true );
          //** tag:automatically_load_images */

          if( empty( $settings[ &#x27;image_size&#x27; ] ) ) {
            $settings[ &#x27;image_size&#x27; ] = $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;property&#x27; ][ &#x27;image_size&#x27; ];
          }
        }

        $needed_image_size = WPP_F::image_sizes( $settings[ &#x27;image_size&#x27; ] );

        if( empty( $images ) || !is_array( $images ) ) {
          return false;
        }

        //** Build image array (and regenerate them if necessary using wpp_get_image_link() */
        foreach( (array) $images as $image_id ) {

          if( !is_numeric( $image_id ) ) {
            continue;
          }

          $image_object = wpp_get_image_link( $image_id, $settings[ &#x27;image_size&#x27; ], array( &#x27;return&#x27; =&gt; &#x27;array&#x27; ) );

          /* Only check widths  - (on purpose because not all image sizes are cropped) */
          if( ( $needed_image_size[ &#x27;width&#x27; ] != $image_object[ &#x27;width&#x27; ] ) ) {
            continue;
          }

          if( !empty( $image_object[ &#x27;link&#x27; ] ) ) {

            $this_caption = array();

            $parent_id        = $wpdb-&gt;get_var( &quot;SELECT post_parent FROM {$wpdb-&gt;prefix}posts WHERE ID = &#x27;$image_id&#x27;&quot; );
            $property_data    = $wpdb-&gt;get_row( &quot;SELECT *  FROM {$wpdb-&gt;prefix}posts WHERE ID = &#x27;$parent_id&#x27; AND post_status = &#x27;publish&#x27;&quot; );
            $post_title       = $property_data-&gt;post_title;
            $post_excerpt     = $property_data-&gt;post_excerpt;
            $property_tagline = get_post_meta( $parent_id, &#x27;tagline&#x27;, true );

            if( !empty( $post_title ) &amp;&amp; $settings[ &#x27;show_title&#x27; ] == &#x27;true&#x27; ) {
              $this_caption[ ] = $post_title;
            }

            if( !empty( $property_tagline ) &amp;&amp; $settings[ &#x27;show_tagline&#x27; ] == &#x27;true&#x27; ) {
              $this_caption[ ] = &#x27;&lt;span&gt;&#x27; . $property_tagline . &#x27;&lt;/span&gt;&#x27;;
            }

            if( !empty( $post_excerpt ) &amp;&amp; $settings[ &#x27;show_excerpt&#x27; ] == &#x27;true&#x27; ) {
              $this_caption[ ] = &#x27;&lt;span&gt;&#x27; . $post_excerpt . &#x27;&lt;/span&gt;&#x27;;
            }

            $this_caption = &#x27;title=&quot;&#x27; . implode( &quot; &quot;, $this_caption ) . &#x27;&quot;&#x27;;

            $this_image = &quot;&lt;img src=\&quot;{$image_object[&#x27;link&#x27;]}\&quot; width=\&quot;{$image_object[&#x27;width&#x27;]}\&quot; height=\&quot;{$image_object[&#x27;height&#x27;]}\&quot; {$this_caption} /&gt;&quot;;

            if( $settings[ &#x27;link_to_property&#x27; ] == &#x27;true&#x27; ) {
              $parent_link = get_permalink( $parent_id );
              $print_image = &quot;&lt;a href=&#x27;{$parent_link}&#x27; class=&#x27;wpp_global_slideshow_link&#x27;&gt;{$this_image}&lt;/a&gt;&quot;;
            } else {
              $print_image = $this_image;
            }
            $print_images[ ] = apply_filters( &#x27;wpp::slideshow::print_image&#x27;, $print_image, $image_id, $settings );

          }

        }

        if( !empty( $print_images ) ) {

          //** Create random class to ID slider */
          $this_slider_id = &#x27;slider_&#x27; . rand( 10000, 99999 );

          $nivoSlider[ &#x27;effect&#x27; ]           = &quot;effect: &#x27;{$settings[&#x27;effect&#x27;]}&#x27;&quot;;
          $nivoSlider[ &#x27;slices&#x27; ]           = &quot;slices: {$settings[&#x27;slices&#x27;]}&quot;;
          $nivoSlider[ &#x27;animSpeed&#x27; ]        = &quot;animSpeed: {$settings[&#x27;animation_speed&#x27;]}&quot;;
          $nivoSlider[ &#x27;pauseTime&#x27; ]        = &quot;pauseTime: {$settings[&#x27;pause_time&#x27;]}&quot;;
          $nivoSlider[ &#x27;directionNav&#x27; ]     = &quot;directionNav: {$settings[&#x27;show_side_navigation&#x27;]}&quot;;
          $nivoSlider[ &#x27;directionNavHide&#x27; ] = &quot;directionNavHide: {$settings[&#x27;show_side_navigation_on_hover_only&#x27;]}&quot;;
          $nivoSlider[ &#x27;controlNav&#x27; ]       = &quot;controlNav: {$settings[&#x27;show_pagination_buttons&#x27;]}&quot;;
          $nivoSlider[ &#x27;captionOpacity&#x27; ]   = &quot;captionOpacity: {$settings[&#x27;caption_opacity&#x27;]}&quot;;
          $nivoSlider                       = apply_filters( &#x27;wpp_slideshow_nivoslider&#x27;, $nivoSlider, $settings );

          ob_start(); ?&gt;
          &lt;script type=&quot;text/javascript&quot;&gt;jQuery( window ).load( function() {
              jQuery( &#x27;div.&lt;?php echo $this_slider_id; ?&gt;&#x27; ).nivoSlider( {&lt;?php echo implode(&#x27;,&#x27;, $nivoSlider); ?&gt;} );
            } );&lt;/script&gt;

          &lt;style type=&#x27;text/css&#x27;&gt;
        . &lt;?php echo $this_slider_id; ?&gt; {
          display: block;
          width: &lt;?php echo $image_object[&#x27;width&#x27;] ?&gt;px;
          height: &lt;?php echo $image_object[&#x27;height&#x27;]; ?&gt;px;
        }

        .&lt;?php echo $this_slider_id; ?&gt; img {
          display: none;
        }

        . &lt;?php echo $this_slider_id; ?&gt; .nivo-controlNav {
          position: absolute;
          bottom: -18px;
        }
      &lt;/style&gt;

          &lt;div class=&quot;&lt;?php echo $this_slider_id; ?&gt; slider &lt;?php echo $settings[ &#x27;class&#x27; ]; ?&gt;&quot;&gt;&lt;?php echo implode( &quot;&quot;, $print_images ); ?&gt;&lt;/div&gt;

          &lt;?php
          $return_result = ob_get_contents();
          ob_end_clean();
        }

        return $return_result;

      }

      /**
       * Used for returning a property-specific slideshow via shortcode
       *
       *
       * @since 3.1
       *
       */
      function shortcode_property_gallery( $atts = &#x27;&#x27; ) {

        //** Ensure galleria script is included */
        WPP_F::force_script_inclusion( &#x27;wp-property-galleria&#x27; );

        return class_wpp_slideshow::display_gallery( $atts );

      }

      /**
       * Used for returning a property-specific slideshow via shortcode
       *
       *
       * @since 3.1
       *
       */
      function shortcode_property_slideshow( $atts = &#x27;&#x27; ) {
        $atts[ &#x27;type&#x27; ] = &#x27;single&#x27;;

        return class_wpp_slideshow::display_slideshow( $atts );

      }

      /**
       * Used for returning the global slideshow via shortcode
       *
       *
       * @todo Consider adding $atts calls here to adjust inline styles
       * @since 3.1
       *
       */
      function shortcode_global_slideshow( $atts = &#x27;&#x27; ) {
        global $post_id, $image_size, $wp_properties;

        $image_size = $wp_properties[ &#x27;configuration&#x27; ][ &#x27;feature_settings&#x27; ][ &#x27;slideshow&#x27; ][ &#x27;glob&#x27; ][ &#x27;image_size&#x27; ];

        $glob_slideshow = WPP_F::image_sizes( $image_size );

        $atts[ &#x27;type&#x27; ] = &#x27;global&#x27;;

        $return = class_wpp_slideshow::display_slideshow( $atts );

        if( empty( $return ) ) {
          return;
        }

        return &quot;&lt;div class=&#x27;wpp_slideshow_global_wrapper wpp_global_slideshow_shortcode&#x27; style=&#x27;position: relative; width:{$glob_slideshow[&#x27;width&#x27;]}px;height:{$glob_slideshow[&#x27;height&#x27;]}px;margin: 0 auto;&#x27;&gt;{$return}&lt;/div&gt;&quot;;
      }

    }

  }

  if( !function_exists( &#x27;global_slideshow&#x27; ) ) {
    /**
     * Used for calling the function programatically
     *
     * Pointless function, in most cases do_shortcode() should be used.
     *
     * @since 3.1
     *
     */
    function global_slideshow( $return = false ) {

      $content = do_shortcode( &quot;[global_slideshow]&quot; );

      if( $return ) {
        return $content;
      }

      echo $content;

    }
  }

  if( !function_exists( &#x27;property_slideshow&#x27; ) ) {
    /**
     * DEPRECIATED FUNCTION. SHOULD BE REMOVED IN THE NEXT REALEASES. MAXIM PESHKOV
     * I don&#x27;t see any places where this function is used.
     *
     * Used for calling the function programatically
     *
     * Pointless function, in most cases do_shortcode() should be used.
     *
     * @since 3.1
     *
     */
    function property_slideshow( $post_id = false, $return = false, $atts = &#x27;&#x27; ) {

      if( $post_id ) {
        $post_id = &quot; id={$post_id} &quot;;
      } else {
        global $post;
        $post_id = &quot; id={$post-&gt;ID} &quot;;
      }

      $content = do_shortcode( &quot;[property_slideshow {$post_id} ]&quot; );

      if( $return ) {
        return $content;
      }

      echo $content;

    }

  }

}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
