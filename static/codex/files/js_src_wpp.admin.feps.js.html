<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/src/wpp.admin.feps.js - usabilitydynamics/wp-property</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="usabilitydynamics/wp-property"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/UsabilityDynamics\WPP.Bootstrap.html">UsabilityDynamics\WPP.Bootstrap</a></li>
            
                <li><a href="../classes/UsabilityDynamics\WPP.Loader.html">UsabilityDynamics\WPP.Loader</a></li>
            
                <li><a href="../classes/UsabilityDynamics\WPP.WPP.html">UsabilityDynamics\WPP.WPP</a></li>
            
                <li><a href="../classes/wpp.html">wpp</a></li>
            
                <li><a href="../classes/wpp.overview.html">wpp.overview</a></li>
            
                <li><a href="../classes/wpp.ui.agents.html">wpp.ui.agents</a></li>
            
                <li><a href="../classes/wpp.ui.feps.html">wpp.ui.feps</a></li>
            
                <li><a href="../classes/wpp.ui.settings.html">wpp.ui.settings</a></li>
            
                <li><a href="../classes/wpp.xmli.html">wpp.xmli</a></li>
            
                <li><a href="../classes/wpp_default_api.html">wpp_default_api</a></li>
            
                <li><a href="../classes/WPP_UI.html">WPP_UI</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js/src/wpp.admin.feps.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * WP-Property FEPS Page ( Property Forms )
 *
 * This file is included on Edit Agent page.
 *
 * @author peshkov@UD
 */
jQuery.extend( wpp = wpp || {}, { ui: { feps: {

  /**
   * Initialize DOM.
   *
   * @for wpp.ui.feps
   * @method ready
   */
  ready: function() {
    var new_tab_href_id = 0;
    var index = jQuery(&#x27;#save_form&#x27;).attr(&#x27;action&#x27;).indexOf(&quot;#&quot;);
    var url   = jQuery(&#x27;#save_form&#x27;).attr(&#x27;action&#x27;).substring(0, index);

    jQuery(&quot;.wpp_feps_tabs&quot;).bind( &quot;tabsselect&quot;, function(event, ui) {
      index = jQuery(&#x27;#save_form&#x27;).attr(&#x27;action&#x27;).indexOf(&quot;#&quot;);
      url   = jQuery(&#x27;#save_form&#x27;).attr(&#x27;action&#x27;).substring(0, index);
      jQuery(&#x27;#save_form&#x27;).attr( &#x27;action&#x27;, url+&#x27;#feps_form_&#x27;+jQuery( ui.panel ).attr(&#x27;feps_form_id&#x27;) );
    });

    jQuery(&quot;.wpp_feps_tabs&quot;).bind( &quot;tabscreate&quot;, function(event, ui) {
      jQuery(&#x27;#save_form&#x27;).attr( &#x27;action&#x27;, url+window.location.hash );
    });

    if( wpp.version_compare( jQuery.ui.version, &#x27;1.10&#x27;, &#x27;&gt;=&#x27; ) ) {
      jQuery(&quot;.wpp_feps_tabs&quot;).tabs();
    } else {
      jQuery(&quot;.wpp_feps_tabs&quot;).tabs({
        add: function(event, ui) {
          jQuery(ui.panel).addClass(&#x27;wpp_feps_form&#x27;).attr(&#x27;feps_form_id&#x27;, new_tab_href_id);
          jQuery(ui.tab).parent().attr(&#x27;feps_form_id&#x27;, new_tab_href_id);
          jQuery(&#x27;.wpp_feps_form table:first&#x27;).clone().appendTo( ui.panel );
          wpp.ui.feps.init_close_btn();
          wpp.ui.feps.set_default_field_values( ui.panel );
          jQuery( &#x27;input[name*=&quot;wpp_feps[forms]&quot;], select[name*=&quot;wpp_feps[forms]&quot;], textarea[name*=&quot;wpp_feps[forms]&quot;]&#x27;, ui.panel ).each(function(key, value){
            jQuery( value ).attr( &#x27;name&#x27;, String(jQuery( value ).attr(&#x27;name&#x27;)).replace(/wpp_feps\[forms\]\[\d.+?\]/, &#x27;wpp_feps[forms][&#x27;+new_tab_href_id+&#x27;]&#x27;) );
          });
          wpp.ui.feps.update_dom();
        }
      });
    }

    wpp.ui.feps.init_close_btn();

    jQuery(&quot;.wpp_add_tab&quot;).click(function() {
      new_tab_href_id = parseInt(Math.random()*1000000);

      if( wpp.version_compare( jQuery.ui.version, &#x27;1.10&#x27;, &#x27;&gt;=&#x27; ) ) {
        var tabs = jQuery(&quot;.wpp_feps_tabs&quot;),
          ul = tabs.find( &quot;&gt;ul&quot; ),
          index = tabs.find( &#x27;&gt;ul &gt;li&#x27;).size(),
          panel = jQuery( &#x27;&lt;div id=&quot;feps_form_&#x27; + new_tab_href_id + &#x27;&quot; class=&quot;wpp_feps_form&quot; feps_form_id=&quot;&#x27; + new_tab_href_id + &#x27;&quot;&gt;&lt;/div&gt;&#x27; );

        jQuery( &quot;&lt;li&gt;&lt;a href=&#x27;#feps_form_&quot; + new_tab_href_id + &quot;&#x27;&gt;&lt;span&gt;&quot; + wpp.strings.feps.unnamed_form + &quot;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot; ).appendTo( ul );
        jQuery(&#x27;.wpp_feps_form table:first&#x27;).clone().appendTo( panel );
        panel.appendTo( tabs );
        tabs.tabs( &quot;refresh&quot; );

        var tab = jQuery( &#x27;&gt;li:last&#x27;, ul );

        tab.attr(&#x27;feps_form_id&#x27;, new_tab_href_id );
        jQuery( &#x27;input[name*=&quot;wpp_feps[forms]&quot;], select[name*=&quot;wpp_feps[forms]&quot;], textarea[name*=&quot;wpp_feps[forms]&quot;]&#x27;, panel ).each( function(key, value){
          jQuery( value ).attr( &#x27;name&#x27;, String(jQuery( value ).attr(&#x27;name&#x27;)).replace(/wpp_feps\[forms\]\[\d.+?\]/, &#x27;wpp_feps[forms][&#x27;+new_tab_href_id+&#x27;]&#x27;) );
        });
        wpp.ui.feps.init_close_btn();
        wpp.ui.feps.set_default_field_values( panel );
        wpp.ui.feps.update_dom();
        tabs.tabs( &quot;option&quot;, &quot;active&quot;, index );
      } else {
        jQuery(&quot;.wpp_feps_tabs&quot;).tabs( &quot;add&quot;, &quot;#feps_form_&quot;+new_tab_href_id, wpp.strings.feps.unnamed_form );
        jQuery(&quot;.wpp_feps_tabs&quot;).tabs( &quot;active&quot;, jQuery(&quot;.wpp_feps_tabs&quot;).tabs( &#x27;length&#x27; )-1 );
      }
    });

    jQuery(&quot;.wpp_dynamic_table_row&quot;).each(function() {
      /* A bit of  hack, but we want users to be able to change rows around as much as they need */
      jQuery(this).attr(&quot;new_row&quot;, &quot;true&quot;);
    });

    jQuery(&quot;.wpp_feps_new_attribute&quot;).live(&quot;change&quot;, function() {
      var parent = jQuery(this).parents(&quot;.wpp_dynamic_table_row&quot;);
      var title = jQuery(&quot;option:selected&quot;, this).text();
      jQuery(&quot;input.title&quot;, parent).val(title);

    });

    /* On form name change */
    jQuery(&quot;.wpp_feps_form .form_title&quot;).live(&quot;change&quot;, function() {
      var title = jQuery(this).val();

      if(title == &quot;&quot;) {
        return;
      }

      var slug = wpp_create_slug(title);
      var this_form = jQuery(this).parents(&quot;.wpp_feps_form&quot;);
      var form_id = jQuery(this_form).attr(&quot;feps_form_id&quot;);

      /* Update tab title */
      jQuery(&quot;.wpp_feps_tabs .tabs li[feps_form_id=&quot;+form_id+&quot;] a span&quot;).text(title);
      /* Update shortcode */
      jQuery(&quot;input.shortcode&quot;, this_form).val(&quot;[wpp_feps_form form=&quot; + slug + &quot;]&quot;);
      /* Update Slug */
      jQuery(&quot;input.slug&quot;, this_form).val(slug);

    });

    jQuery(&quot;a.wpp_forms_remove_attribute&quot;).live(&#x27;click&#x27;, function(){
      var row_to_be_removed = jQuery(this).attr(&quot;row&quot;);
      var context           = jQuery(this).parents(&quot;div.wpp_feps_form .ud_ui_dynamic_table&quot;);
      var rows              = jQuery(&quot;tr.wpp_dynamic_table_row&quot;, context);
      if ( rows.length &gt; 2 ) {
        rows.each(function(k, v){
          if ( jQuery(v).attr(&quot;random_row_id&quot;) == row_to_be_removed ) {
            jQuery(v).remove();
          }
        });
      }
      wpp.ui.feps.update_dom();
    });

    jQuery(&quot;select.wpp_feps_new_attribute&quot;).live(&#x27;change&#x27;, function(){
      wpp.ui.feps.update_dom();
    });

    jQuery(&quot;input.imageslimit&quot;).live(&#x27;change&#x27;, function(){
      if ( jQuery(this).val() &lt; 1 ) jQuery(this).val(1);
    });

    wpp.ui.feps.update_dom();
  },


  /**
   * Render Close button on tabs
   *
   * @for wpp.ui.feps
   * @method init_close_btn
   */
  init_close_btn: function(){
    // Add remove button for tabs
    jQuery(&#x27;ul.tabs li.ui-state-default:not(:first):not(:has(a.remove-tab))&#x27;)
      .append(&#x27;&lt;a href=&quot;javascript:void(0);&quot; class=&quot;remove-tab&quot;&gt;x&lt;/a&gt;&#x27;)
      .mouseenter(function(){
        jQuery(&#x27;a.remove-tab&#x27;, this).show(&#x27;fast&#x27;);
      })
      .mouseleave(function(){
        jQuery(&#x27;a.remove-tab&#x27;, this).hide(&#x27;fast&#x27;);
      });
    // On remove tab button click
    jQuery(&#x27;ul.tabs li a.remove-tab&#x27;).unbind(&#x27;click&#x27;);
    jQuery(&#x27;ul.tabs li a.remove-tab&#x27;).click(function(e){
      var feps_form_id = jQuery(e.target).closest(&#x27;li&#x27;).attr(&#x27;feps_form_id&#x27;);
      if ( feps_form_id ) {
        //* Check if form can be removed */
        jQuery.ajax({
          url: wpp.instance.ajax_url,
          async: false,
          data: {
            action: &#x27;wpp_feps_can_remove_form&#x27;,
            feps_form_id: feps_form_id
          },
          success: function(response){
            var data = eval(&#x27;(&#x27; + response + &#x27;)&#x27;);
            if( data.success ) {
              if( wpp.version_compare( jQuery.ui.version, &#x27;1.10&#x27;, &#x27;&gt;=&#x27; ) ) {
                // Remove the tab
                var tab = jQuery( &quot;.wpp_feps_tabs&quot; ).find( &quot;.ui-tabs-nav li[feps_form_id=&#x27;&quot; + feps_form_id + &quot;&#x27;]&quot; ).remove();
                // Find the id of the associated panel
                var panelId = tab.attr( &quot;aria-controls&quot; );
                // Remove the panel
                jQuery( &quot;#&quot; + panelId ).remove();
                // Refresh the tabs widget
                jQuery( &quot;.wpp_feps_tabs&quot; ).tabs( &quot;refresh&quot; );
              } else {
                jQuery(&quot;.wpp_feps_tabs&quot;).tabs(&#x27;remove&#x27;, jQuery(this).parent().index());
              }
            } else {
              alert( data.message );
            }
          },
          error: function() {
            alert( wpp.strings.feps.form_could_not_be_removed_1 );
          }
        });
      } else {
        alert( wpp.strings.feps.form_could_not_be_removed_2 );
      }
    });
  },


  /**
   * Set default field values after adding new tab
   *
   * @for wpp.ui.feps
   * @method set_default_field_values
   */
  set_default_field_values: function( context ) {
    jQuery(&quot;input.form_title&quot;, context).val(&#x27;Unnamed Form&#x27;).trigger(&#x27;change&#x27;);
    jQuery(&quot;input.shortcode&quot;, context).val(&#x27;[wpp_feps_form form=&#x27;+wpp_create_slug(&#x27;Unnamed Form &#x27;+jQuery(context).attr(&#x27;feps_form_id&#x27;))+&#x27;]&#x27;);
    jQuery(&quot;input.slug&quot;, context).val(wpp_create_slug(&#x27;Unnamed Form &#x27;+jQuery(context).attr(&#x27;feps_form_id&#x27;)));
    jQuery(&quot;.ud_ui_dynamic_table&quot;, context).each(function(){
      jQuery(&quot;tr.wpp_dynamic_table_row&quot;, jQuery(this)).find(&quot;textarea.description&quot;).val(&#x27;&#x27;);
      jQuery(&quot;tr.wpp_dynamic_table_row:not(.required):not(:first)&quot;, jQuery(this)).remove();
    });
  },


  /**
   * Update dom after changes
   *
   * @for wpp.ui.feps
   * @method update_dom
   */
  update_dom: function () {
    jQuery(&quot;.wpp_feps_sortable tbody&quot;).sortable( { items: &#x27;tr.wpp_dynamic_table_row:not(.required)&#x27; } );

    jQuery(&quot;.wpp_feps_sortable tr.wpp_dynamic_table_row&quot;).live(&quot;mouseover&quot;, function() {
      jQuery(this).addClass(&quot;wpp_draggable_handle_show&quot;);
    });

    jQuery(&quot;.wpp_feps_sortable tr.wpp_dynamic_table_row&quot;).live(&quot;mouseout&quot;, function() {
      jQuery(this).removeClass(&quot;wpp_draggable_handle_show&quot;);
    });

    jQuery(&quot;.wpp_feps_sortable tr.wpp_dynamic_table_row&quot;).each(function(k, v){
      var random_row_id = jQuery(v).attr(&quot;random_row_id&quot;);
      jQuery(v).find(&quot;a.wpp_forms_remove_attribute&quot;).attr(&quot;row&quot;, random_row_id);
    });

    //* Determine if form allows to upload images and show/hide images settings */
    jQuery(&quot;.ui-tabs-panel&quot;).each(function(k,v){
      var image_upload = false,
          plan_images_col = jQuery(&#x27;.wpp_plan_images_limit_col&#x27;, v),
          feps_credits = jQuery(&#x27;input.feps_credits&#x27;, v);
      jQuery(&quot;select.wpp_feps_new_attribute option:selected&quot;, v).each(function(i, e){
        if ( jQuery(e).val() == &#x27;image_upload&#x27; ) {
          image_upload = true;
          return false;
        }
      });
      if( image_upload ) {
        if ( !feps_credits.length &gt; 0 || ( feps_credits.length &gt; 0 &amp;&amp; !feps_credits.is(&#x27;:checked&#x27;) ) ) {
          jQuery(&#x27;input.imageslimit&#x27;, v).parent().show();
        }
        if( plan_images_col.length &gt; 0 ) {
          plan_images_col.show();
        }
      } else {
        jQuery(&#x27;input.imageslimit&#x27;, v).parent().hide();
        if( plan_images_col.length &gt; 0 ) {
          plan_images_col.hide();
        }
      }
    });
  },


  /**
   * Ran after a row is added
   *
   * @for wpp.ui.feps
   * @method on_added_row
   */
  on_added_row: function(added_row) {
    /* Set the title */
    wpp.ui.feps.update_dom();
  }

}}});

// Initialize Overview.
jQuery( document ).ready( wpp.ui.feps.ready );
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
